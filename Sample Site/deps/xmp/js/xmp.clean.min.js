/* ==========================================================
* xmp.clean.min.js 3.1.3, build 438
* ==========================================================
* Copyright 2019 XMPie, LTD.
* ========================================================== */

var muCreateXMVersion = "3.1.3";
var muCreateXMBuild = 438;


//Because we place all block in $(document).ready function we needed to expose these global variables outside xmpControllerDriver, xmpResourceDriver
var xmpControllerDriver;
var xmpResourceDriver;


function waitForScriptLoad(attemptNumber) {
  if (attemptNumber > 5)
  {
    console.log('jQuery couldnt be found, please add the script to your html file');
    return;
  }
  attemptNumber++;
  if (typeof jQuery == 'undefined')
  {
    console.log('Attempt number ' + attemptNumber + ': jQuery couldnt be found, try again in 1 second');
    setTimeout(function() {waitForScriptLoad(attemptNumber)},1000);
  }
  else
  {
    console.log('jQuery was found, start XMPL app');
    loadXmplGeneralScript();
  }

}


function loadXmplGeneralScript()
{

  $(document).ready(function()
  {
    if (typeof jQuery != 'undefined')
    {
      console.log('jQuery version: ' + jQuery.fn.jquery);

      // Min jQuery Version 1.10.2
      var jQueryVersion = jQuery.fn.jquery.split('.');
      if (!(
        Number(jQueryVersion[0]) > 1 ||
        Number(jQueryVersion[0]) === 1 && (
          Number(jQueryVersion[1]) > 10 || Number(jQueryVersion[1]) === 10 && Number(jQueryVersion[2]) >= 2
        )
      )) {
        console.log('Please note jQuery version ' + jQuery.fn.jquery + ' is not supported for this XMPL version');
      }
    }
/*!
 * Platform.js v1.0.0 <http://mths.be/platform>
 * Copyright 2010-2014 John-David Dalton <http://allyoucanleet.com/>
 * Available under MIT license <http://mths.be/mit>
 */

function createAsyncReplacement(element,attrs){var elementDimensions={width:element.width(),height:element.height()};element.hide();var $imgAlternative=$(document.createElement("div"));$imgAlternative.addClass(attrs.xmpAsyncBusyClass||"xmp-busy"),element.after($imgAlternative),void 0!=attrs.xmpAdaptProgressSize&&elementDimensions.width>0&&elementDimensions.height>0&&($imgAlternative.width(elementDimensions.width),$imgAlternative.height(elementDimensions.height))}function destroyAsyncReplacement(element){element.next().remove(),element.show()}function toBoolean(value){return value=!(!value||0===value.length)&&!("0"==value||"false"==value)}function waitForRecipientSourceWithAdorAttribute(xmpResource,inScope,inAttributeValue,inCallback){var adorIdentity=getADORIdentityFromAttribute(xmpResource,inAttributeValue);if(adorIdentity.isRecipient)var unregister=inScope.$watch("xmp.recipientReady",function(value){value&&(unregister(),inScope.xmp.recipientID&&inCallback.call(null,adorIdentity.isRecipient,adorIdentity.adorName,inScope.xmp.r[adorIdentity.adorName]))});else if(Object.keys(referredRecipientADORs).length>0)var unregister=inScope.$watch("xmp.referredID",function(value){value&&(unregister(),inCallback.call(null,adorIdentity.isRecipient,adorIdentity.adorName,inScope.xmp.referredRecipient[adorIdentity.adorName]))})}function getADORIdentityFromAttribute(xmpResource,inAttributeValue){var recipientADORs={},referredRecipientADORs={};xmpResource.populateRecipientADORsInExpression(inAttributeValue,recipientADORs,referredRecipientADORs);var isRecipient=Object.keys(recipientADORs).length>0;return{isRecipient:isRecipient,adorName:isRecipient?Object.keys(recipientADORs)[0]:Object.keys(referredRecipientADORs)[0]}}function isolateSuccessFailureProperties($scope){$scope.failureTrackAction=null,$scope.failureJSAction=null,$scope.failureNGAction=null,$scope.failureNGAction=null,$scope.failureURL=null,$scope.successEmail=null,$scope.successTrackAction=null,$scope.successJSAction=null,$scope.successNGAction=null,$scope.successURL=null}function isActionContainer(iElement,iAttrs){return iElement.is("FORM")||"XMPPersonalizedPage"==iAttrs.ngController||"XMPAnonymousPage"==iAttrs.ngController}function activateScopePropertyForFormOrButton(scope,iElement,iAttrs,inAttributeName,inPropertyName){isActionContainer(iElement,iAttrs)?iAttrs.$observe(inAttributeName,function(value){value&&(scope[inPropertyName]=value)}):iElement.on("click."+inAttributeName,function(){scope[inPropertyName]=iAttrs[inAttributeName]})}function toTitleCase(inString){return 0==inString.length?inString:inString.charAt(0).toUpperCase()+inString.substring(1).toLowerCase()}function getDefaultTrackingElementName(inJElement){var result;switch(inJElement[0].tagName.toLowerCase()){case"a":result="Link";break;case"input":var type=inJElement[0].type;if(type)switch(type.toLowerCase()){case"button":case"submit":case"reset":result="Button";break;case"image":result="Image Button";break;case"checkbox":result="Checkbox";break;case"radio":result="Radio Button";break;default:result="Textbox"}break;case"select":case"option":result="Dropdown";break;case"textarea":result="Textarea";break;case"img":result="Image";break;case"p":result="Paragraph";break;case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":result="Header";break;case"table":result="Table";break;case"tr":result="Table Row";break;case"td":result="Table Cell";break;case"iframe":result="IFrame";break;default:result=toTitleCase(inJElement[0].tagName)}return result}function getDefaultTrackingEventType(inJElement){return"a"==inJElement[0].tagName.toLowerCase()?"Navigated":"Performed Action"}function getHTMLEventForTrackingForElement(inJElement){var result;switch(inJElement[0].tagName.toLowerCase()){case"a":result="mouseup";break;case"input":var type=inJElement[0].type,isclick=!1;if(type)switch(type.toLowerCase()){case"image":case"submit":case"button":case"reset":isclick=!0;break;default:isclick=!1}result=isclick?"mousedown":"change";break;case"select":case"option":result="change";break;default:result="mousedown"}return result}function runFBActionIfInit(inAppID,inAction){window.fbAsyncInit?inAction():(window.fbAsyncInit=function(){FB.init({appId:inAppID,xfbml:!0,version:"v2.0"}),inAction()},function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="//connect.facebook.net/en_US/sdk.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","facebook-jssdk"))}function isServerAssetExpression(inItem){return"server:"==inItem.substring(0,7)}function loadAsync(scope,inElement,inAttributes,controller,xmpResource,$window){createAsyncReplacement(inElement,inAttributes),runAsyncGet(xmpResource,$window,scope,scope.asyncRecipientADORs,scope.asyncReferredRecipientADORs,function(){destroyAsyncReplacement(inElement)})}function loadAsyncAdor(scope,inElement,inAttributes,controller,xmpResource,$window){runAsyncGet(xmpResource,$window,scope,scope.asyncRecipientADORs,scope.asyncReferredRecipientADORs)}function runAsyncGet(xmpResource,$window,scope,inRecipientADORsSet,inReferredRecipientADORsSet,onSuccessCB){function getResolvedAdorsForAdorsList(inIsRecipient,adorsList){var targetQueryDict=inIsRecipient?scope.defaultAdorsForResolve:scope.defaultAdorsForReferredResolve,result=[];return adorsList.forEach(function(inADOR){targetQueryDict[inADOR]&&result.push(inADOR)}),result}var recipientADORsFields=Object.keys(inRecipientADORsSet),referredRecipientADORsFields=Object.keys(inReferredRecipientADORsSet),asyncJobs={};scope.xmpReady(function(){var recipientRequestsDescriptors=[{adorsList:recipientADORsFields,objectName:"r",recipientID:scope.xmp.recipientID},{adorsList:referredRecipientADORsFields,objectName:"referredRecipent",recipientID:scope.xmp.referredID}],totalJobs=0==recipientRequestsDescriptors[0].adorsList.length?0:1+recipientRequestsDescriptors[1].adorsList.length==0?0:1;recipientRequestsDescriptors.forEach(function(inParameters){0!=inParameters.adorsList.length&&inParameters.recipientID&&(xmpResource.debug("runAsyncGet: starting async query. recipient id =",inParameters.recipientID,"adors=",inParameters.adorsList),setupLoadStatus(scope.xmp,inParameters.objectName,inParameters.adorsList,eADORsLoading),xmpResource.getRecipientADORs(inParameters.recipientID,{adors:inParameters.adorsList,resolved:getResolvedAdorsForAdorsList("r"==inParameters.objectName,inParameters.adorsList),async:!0}).$promise.then(function(result){asyncJobs[result.jobID]={keys:inParameters.adorsList,target:inParameters.objectName,initStatus:result.status,initValues:result.values},Object.keys(asyncJobs).length==totalJobs&&scope.trackAsyncJobs(asyncJobs,onSuccessCB)}))})})}function stringOfStatus(inStatus){return kPDFOnDemandStatuses[inStatus+1]}function getRecipientADORName(xmpResource,inExpression){var dictRecipient={},dictReferred={};return xmpResource.populateRecipientADORsInExpression(inExpression,dictRecipient,dictReferred),Object.keys(dictRecipient)[0]}function getServerAssetExpression(inItem){return inItem.substring(7)}function isLoginError(inHTTPError){return"POST"==inHTTPError.config.method&&inHTTPError.config.url.match(/\/login$/)}function isRecipientGetError(inHTTPError){return"GET"==inHTTPError.config.method&&inHTTPError.config.url.match(/\/resource\/[^/]*\/recipients\/[^/]*$/)}function isRecipientUpdateError(inHTTPError){return"PUT"==inHTTPError.config.method&&inHTTPError.config.url.match(/\/resource\/[^/]*\/recipients\/[^/]*$/)}function isRecipientCreateError(inHTTPError){return"POST"==inHTTPError.config.method&&inHTTPError.config.url.match(/\/resource\/[^/]*\/recipients$/)}function getSpecificErrorDetails(inHTTPError){return isRecipientGetError(inHTTPError)?"Cannot get recipient data. The most probable reason is that the recipient ID is not available in the database (check the page URL for the recipient ID), or that the server is not responsive (down)":isLoginError(inHTTPError)?"Cannot login to XMPL server. The most probable reason is that the server is not responsive (down)":isRecipientUpdateError(inHTTPError)?"Cannot update recipient data. The most probable reason is that the recipient ID is not available in the database (check the page URL for the recipient ID), or that the server is not responsive (down)":isRecipientCreateError(inHTTPError)?"Cannot create a new recipient. The most probable reason is that the server is not responsive (down)":""}function changeLocation($scope,$location,url,forceReload){$scope=$scope||angular.element(document).scope(),forceReload||$scope.$$phase?window.location=url:($location.path(url),$scope.$apply())}function initAsyncConfig($scope,$injector){try{var asyncConfig=$injector.get("appConfig")();void 0!==asyncConfig.asyncAttempts&&($scope.asyncAttempts=asyncConfig.asyncAttempts),void 0!==asyncConfig.asyncWaitTime&&($scope.asyncWaitTime=asyncConfig.asyncWaitTime)}catch(e){}}function personalizedViewController($scope,$location,$window,$injector,$cookies,$parse,xmpResource,declareADORsCB,setupDefaultErrorPageCB){function saveADORsOnLoad(scope,xmpResoruce){xmpResource.adorsToSetOnLoad&&0!=Object.keys(xmpResource.adorsToSetOnLoad).length&&(xmpResource.debug("saveADORsOnLoad: saving adors on page load, adors:",xmpResource.adorsToSetOnLoad),xmpResource.saveRecipientADORs(scope.xmp.recipientID,xmpResource.adorsToSetOnLoad),xmpResource.adorsToSetOnLoad=null)}commonControllersSetup($scope,$location,$window,$injector,$cookies,$parse,xmpResource,declareADORsCB,setupDefaultErrorPageCB);var loginResult,defaultADORs=Object.keys($scope.defaultAdorsForGet),withADORsRetrieve=defaultADORs.length>0;withADORsRetrieve?(setupLoadStatus($scope.xmp,"r",defaultADORs,eADORsLoading),xmpResource.debug("personalizedViewController: running login+retrieve. service token cookie =",$cookies.xmpServiceToken,"recipient id cookie =",$cookies.xmpRecipientID,"recipient fields =",defaultADORs),loginResult=xmpResource.getRecipientADORs(null,{adors:defaultADORs,resolved:Object.keys($scope.defaultAdorsForResolve),login:{cached:{serviceToken:$cookies.xmpServiceToken,recipientID:$cookies.xmpRecipientID}}})):(xmpResource.debug("personalizedViewController: running login only (no retrieve). service token cookie =",$cookies.xmpServiceToken,"recipient id cookie =",$cookies.xmpRecipientID),loginResult=xmpResource.login($cookies.xmpServiceToken,$cookies.xmpRecipientID,!0)),loginResult.$promise.then(function(result){if(withADORsRetrieve){$scope.xmp.recipientID=result.login.recipientID;var resultAnalysis=analyzeGetADORSResponse(result.result,"r");$scope.xmp.r=result.result,setupLoadStatus($scope.xmp,"r",resultAnalysis.readyADORs,eADORsLoaded),$scope.formDefaultAdors&&$.each($scope.formDefaultAdors,function(key,value){void 0==$scope.xmp.r[key]||""!=$scope.xmp.r[key]&&null!=$scope.xmp.r[key]||($scope.xmp.r[key]=value)}),$scope.trackAsyncJobs(resultAnalysis.asyncJobs)}else $scope.xmp.recipientID=result.recipientID,$scope.xmp.r={};xmpResource.debug("personalizedViewController: success in login/load. Recipient ID is ",$scope.xmp.recipientID),recipientReady($scope),setCookie("xmpServiceToken",xmpResource.access.serviceToken,9999),setCookie("xmpRecipientID",$scope.xmp.recipientID,9999),referredRecipientSetup($scope,$location,$cookies,xmpResource),$window.setTimeout(function(){saveADORsOnLoad($scope,xmpResource)},0)},function(reason){setupLoadStatus($scope.xmp,"r",defaultADORs,eADORsFailed),recipientError($scope,reason),referredRecipientError($scope)})}function createDefaultErrorNode($element,$compile,$scope){var $newNode=$(document.createElement("div")).addClass("xmp-default-error-node");$element.append($newNode),$compile($newNode)($scope)}function setCookie(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+"; "+expires}function getCookie(name){var value="; "+document.cookie,parts=value.split("; "+name+"=");if(2==parts.length)return parts.pop().split(";").shift()}function getFailureCBForRecipientSubmit($location,$parse,scope,xmpResource,inPostActionParameters){return function(reason){inPostActionParameters.failureTrackAction&&(xmpResource.debug("onRecipientSubmitSuccess: tracking on failure"),trackSimpleAction(scope,xmpResource,inPostActionParameters.failureTrackAction,inPostActionParameters.failureURL)),inPostActionParameters.failureJSAction&&(xmpResource.debug("onRecipientSubmitSuccess: running global javascript command on success:",inPostActionParameters.failureJSAction),eval(inPostActionParameters.failureJSAction)),inPostActionParameters.failureNGAction&&(xmpResource.debug("onRecipientSubmitSuccess: running scope method on failure:",inPostActionParameters.failureNGAction),$parse(inPostActionParameters.failureNGAction)(scope)),inPostActionParameters.failureURL?(xmpResource.debug("onRecipientSubmitSuccess: redirecting to another URL on failure:",inPostActionParameters.failureURL),changeLocation(scope,$location,inPostActionParameters.failureURL)):scope.showDefaultFailurePage&&scope.transitToFailureView(reason)}}function onRecipientSubmitSuccess($window,$location,$parse,xmpResource,scope,inPostActionParameters,inEmailRecipientID,inDoneCB){$window.setTimeout(function(){inPostActionParameters.successEmail&&(xmpResource.debug("onRecipientSubmitSuccess: sending success email"),sendEmailorTrigger(xmpResource,scope,inPostActionParameters.successEmail,inEmailRecipientID||scope.xmp.recipientID,inPostActionParameters.successURL)),inPostActionParameters.successEmailTrigger&&(xmpResource.debug("onRecipientSubmitSuccess: sending success trigger email"),sendEmailorTrigger(xmpResource,scope,inPostActionParameters.successEmailTrigger,inEmailRecipientID||scope.xmp.recipientID,inPostActionParameters.successURL)),inPostActionParameters.successTrackAction&&(xmpResource.debug("onRecipientSubmitSuccess: tracking on success"),trackSimpleAction(scope,xmpResource,inPostActionParameters.successTrackAction,inPostActionParameters.successURL)),inPostActionParameters.successJSAction&&(xmpResource.debug("onRecipientSubmitSuccess: running global javascript command on success:",inPostActionParameters.successJSAction),eval(inPostActionParameters.successJSAction)),inPostActionParameters.successNGAction&&(xmpResource.debug("onRecipientSubmitSuccess: running scope method on success:",inPostActionParameters.successNGAction),$parse(inPostActionParameters.successNGAction)(scope)),inPostActionParameters.successURL&&(xmpResource.debug("onRecipientSubmitSuccess: redirecting to another URL on success:",inPostActionParameters.successURL),changeLocation(scope,$location,inPostActionParameters.successURL,!0)),inDoneCB&&(xmpResource.debug("onRecipientSubmitSuccess: running callback on success"),inDoneCB())},0)}function setupLoadStatus(inXMPObject,inMember,inAdorsList,inStatus){inXMPObject.status[inMember]||(inXMPObject.status[inMember]={});var target=inXMPObject.status[inMember];inAdorsList.forEach(function(inADOR){target[inADOR]=inStatus}),inStatus!=eADORsFailed||inXMPObject.status.adorfailure||(inXMPObject.status.adorfailure=!0)}function sendEmailorTrigger(xmpResource,scope,inEmailReference,inRecipientID,inSync){inEmailReference.id.split(",").forEach(function(inEmailID){var touchpointID,customizations,emailConfig=xmpResource.emails?xmpResource.emails[inEmailID]:null;emailConfig?(touchpointID=emailConfig.touchpoint,customizations=emailConfig.customizations):(touchpointID=inEmailID,customizations=inEmailReference.customizations),xmpResource.debug("sendEmailorTrigger: sending email. touchpoint ID = ",touchpointID,"customizations = ",customizations),xmpResource.sendEmailorTrigger(touchpointID,{sync:inSync,recipientID:inRecipientID,customizations:customizations},null,function(reason){scope.transitToFailureView(reason)})})}function trackSimpleAction(scope,xmpResource,inAction,inSync){scope.trackingPageName?xmpResource.trackEvent(inAction,{sync:inSync,recipientID:scope.xmp.recipientID,properties:xmpResource.addDefaultTrackingParameters({PageName:scope.trackingPageName,ActionName:inAction})}):xmpResource.error("trackSimpleAction: cannot track. tracking page name was not assigned ")}function recipientReady($scope){$scope.xmp.recipientReady=!0,broadcastIfReady($scope)}function recipientError($scope,reason){$scope.xmp.recipientReady=!0,$scope.xmp.recipientFailed=!0,$scope.xmp.recipientFailureReason=reason,broadcastIfReady($scope)}function analyzeGetADORSResponse(result,inTarget){var readyADORs=[],asyncJobs={};for(var ador in result)result[ador]&&result[ador].uImage?(asyncJobs[result[ador].jobID]||(asyncJobs[result[ador].jobID]={keys:[],target:inTarget}),asyncJobs[result[ador].jobID].keys.push(ador),result[ador]=null):readyADORs.push(ador);return{readyADORs:readyADORs,asyncJobs:asyncJobs}}function referredRecipientSetup($scope,$location,$cookies,xmpResource){if($scope.xmp.referredID=$cookies.xmpReferredID,$scope.xmp.referredID){var referredDefaultADORs=Object.keys(xmpResource.defaultAdorsForReferredGet);if(referredDefaultADORs.length>0){xmpResource.debug("referredRecipientSetup: retrieving referred recipient data. id = ",$scope.xmp.referredID," fields = ",referredDefaultADORs),setupLoadStatus($scope.xmp,"referredRecipient",referredDefaultADORs,eADORsLoading);var result=xmpResource.getRecipientADORs($scope.xmp.referredID,{adors:referredDefaultADORs,resolved:xmpResource.defaultAdorsForReferredResolve});result.$promise.then(function(){var resultAnalysis=analyzeGetADORSResponse(result,"referredRecipient");$scope.xmp.referredRecipient=result,setupLoadStatus($scope.xmp,"referredRecipient",resultAnalysis.readyADORs,eADORsLoaded),$scope.trackAsyncJobs(resultAnalysis.asyncJobs),$scope.xmp.referredRecipientReady=!0,broadcastIfReady($scope)},function(reason){$scope.xmp.referredRecipient={},setupLoadStatus($scope.xmp,"referredRecipient",referredDefaultADORs,eADORsFailed),referredRecipientError($scope,reason)})}else $scope.xmp.referredRecipient={},$scope.xmp.referredRecipientReady=!0,broadcastIfReady($scope)}else $scope.xmp.referredRecipient={},$scope.xmp.referredRecipientReady=!0,broadcastIfReady($scope);$scope.defaultAdorsForReferredGet=xmpResource.defaultAdorsForReferredGet,$scope.defaultAdorsForReferredResolve=xmpResource.defaultAdorsForReferredResolve,xmpResource.defaultAdorsForReferredGet=null,xmpResource.defaultAdorsForReferredResolve=null}function referredRecipientError($scope,reason){$scope.xmp.referredRecipientReady=!0,$scope.xmp.referredRecipientFailed=!0,$scope.xmp.referredRecipientFailureReason=reason,broadcastIfReady($scope)}function broadcastIfReady($scope){$scope.xmp.referredRecipientReady&&$scope.xmp.recipientReady&&($scope.xmp.ready=!0,$scope.$root.$broadcast("xmpReady"),$scope.xmpResource.debug("broadcastIfReady: ready"))}function commonControllersSetup($scope,$location,$window,$injector,$cookies,$parse,xmpResource,declareADORsCB,setupDefaultErrorPageCB){$scope.xmpResource=xmpResource,xmpResource.createDefaultRetrieveDictionaries(),xmpResource.trackOnPageLoad&&($scope.successTrackAction="Page Visit"),$scope.showDefaultFailurePage=!xmpResource.turnOffDefaultErrorPage,$scope.showDefaultFailurePage&&setupDefaultErrorPageCB(),$scope.xmpReady=function(cb){$scope.xmp&&$scope.xmp.ready?cb.call(null):$scope.$on("xmpReady",function(){cb.call(null)})},$scope.xmp?(xmpResource.debug("commonControllersSetup: sharing xmp object with higher level scope"),$scope.xmp.status?$scope.xmp.status.adorFailure=!1:$scope.xmp.status={adorfailure:!1}):(xmpResource.debug("commonControllersSetup: creating independent xmp object"),$scope.xmp={status:{adorfailure:!1}}),declareADORsCB.call(),$scope.trackingPageName=xmpResource.trackingPageName,$scope.xmpReady(function(){$scope.xmp.recipientFailed||$scope.xmp.referredRecipientFailed?(getFailureCBForRecipientSubmit($location,$parse,$scope,xmpResource,$scope)($scope.xmp.recipientFailureReason||$scope.xmp.referredRecipientFailureReason),xmpResource.error("commonControllersSetup: initial load failed")):(xmpResource.debug("commonControllersSetup: initial load succesful"),onRecipientSubmitSuccess($window,$location,$parse,xmpResource,$scope,$scope))}),xmpResource.turnOffDefaultErrorPage=null,xmpResource.trackOnPageLoad=null,xmpResource.trackingPageName=null,$scope.defaultAdorsForGet=xmpResource.defaultAdorsForGet,$scope.defaultAdorsForResolve=xmpResource.defaultAdorsForResolve,xmpResource.defaultAdorsForGet=null,xmpResource.defaultAdorsForResolve=null,$scope.transitToFailureView=function(reason){void 0===$("body").attr("xmp-prevent-default-error-handle")&&(xmpResource.debug("running default transition to error view",reason),$scope.xmp.errorReason=reason)},$scope.updateAdorsForFields=function(inFields,inPostActionParameters){if(inFields){var savedADORs={};for(var key in inFields)savedADORs[key]=$scope.xmp.r[key];xmpResource.debug("updateAdorsForFields: updating adors for recipient. adors =",savedADORs);var getADORs=Object.keys($scope.defaultAdorsForGet);setupLoadStatus($scope.xmp,"r",getADORs,eADORsLoading);var resolvedADORs=Object.keys($scope.defaultAdorsForResolve);xmpResource.saveRecipientADORs($scope.xmp.recipientID,savedADORs,{retrieveADORs:getADORs.length>0?getADORs:void 0,resolvedADORs:resolvedADORs.length>0?resolvedADORs:void 0}).$promise.then(function(result){xmpResource.debug("updateAdorsForFields: success in updating adors");var resultAnalysis=analyzeGetADORSResponse(result,"r");resultAnalysis.readyADORs.forEach(function(key){$scope.xmp.r[key]=result[key]}),setupLoadStatus($scope.xmp,"r",resultAnalysis.readyADORs,eADORsLoaded),$scope.trackAsyncJobs(resultAnalysis.asyncJobs),$scope.$broadcast("xmpRecipientUpdate"),onRecipientSubmitSuccess($window,$location,$parse,xmpResource,$scope,inPostActionParameters)},getFailureCBForRecipientSubmit($location,$parse,$scope,xmpResource,inPostActionParameters))}},$scope.submitSign=function(useername,password){xmpResource.signin($scope.xmp.recipientID,useername,password)},$scope.submitSignOut=function(){xmpResource.signOut($scope.xmp.recipientID)},$scope.sendEmailorTriggerToRecipient=function(inEmailReference){sendEmailorTrigger(xmpResource,$scope,inEmailReference,$scope.xmp.recipientID)},$scope.sendEmailorTriggerToReferredRecipient=function(inEmailReference){sendEmailorTrigger(xmpResource,$scope,inEmailReference,$scope.xmp.referredID)},$scope.addReferredRecipientForFields=function(inFields,inActionParameters,inExtraADORsForRetrieve){if(inFields){var savedADORs={};for(var key in inFields)savedADORs[key]=inActionParameters.xmp.referredRecipient[key];var referredDefaultADORs=Object.keys($scope.defaultAdorsForReferredGet),referredDefaultADORsResolved=Object.keys($scope.defaultAdorsForReferredResolve);inExtraADORsForRetrieve&&inExtraADORsForRetrieve.forEach(function(key){referredDefaultADORs.push(key)}),setupLoadStatus($scope.xmp,"referredRecipient",referredDefaultADORs,eADORsLoading),xmpResource.debug("addReferredRecipientForFields: adding referred recipient. saved data =",savedADORs,". data to retrieve = ",referredDefaultADORs),xmpResource.addRecipient({adors:savedADORs,retrieveADORs:referredDefaultADORs,resolvedADORs:referredDefaultADORsResolved}).$promise.then(function(result){$scope.xmp.referredID=result.recipientID;var resultAnalysis=analyzeGetADORSResponse(result.values,"referredRecipient");resultAnalysis.readyADORs.forEach(function(key){$scope.xmp.referredRecipient[key]=result.values[key]}),setupLoadStatus($scope.xmp,"referredRecipient",resultAnalysis.readyADORs,eADORsLoaded),$scope.trackAsyncJobs(resultAnalysis.asyncJobs),$cookies.xmpReferredID=$scope.xmp.referredID,delete inActionParameters.xmp,xmpResource.debug("addReferredRecipientForFields: success in adding referred recipient. referred recipient id = ",$scope.xmp.referredID),onRecipientSubmitSuccess($window,$location,$parse,xmpResource,$scope,inActionParameters,$scope.xmp.referredID,function(){inActionParameters.resetXMP()})},getFailureCBForRecipientSubmit($location,$parse,$scope,xmpResource,inActionParameters))}},$scope.getXmp=function(){return $scope.xmp},$scope.getRecipientData=function(){return $scope.xmp.r},$scope.getReferredRecipientData=function(){return $scope.xmp.referredRecipient},$scope.getRecipientID=function(){return $scope.xmp.recipientID},$scope.getReferredRecipientID=function(){return $scope.xmp.referredID},$scope.asyncWaitTime=1500,$scope.asyncAttempts=100,initAsyncConfig($scope,$injector),$scope.trackAsyncJobs=function(asyncJobs,onDoneCB){function asyncWait(inAllJobs,inJobID,inRetriesCount){xmpResource.debug("trackAsyncJobs,asyncWait: job with id =",inJobID,"still in progress, current retry count is",inRetriesCount),xmpResource.getRecipientQueryStatus({jobID:inJobID}).$promise.then(function(result){result.status==eJobInProgress?inRetriesCount==$scope.asyncAttempts?(asyncJobDone(inAllJobs,inJobID,eJobFailed),xmpResource.error("trackAsyncJobs,asyncWait: retry timeout reached. failing")):$window.setTimeout(function(){asyncWait(inAllJobs,inJobID,inRetriesCount+1)},$scope.asyncWaitTime):asyncJobDone(inAllJobs,inJobID,result.status,result.values)})}function asyncJobDone(inAllJobs,inJobID,inStatus,inValues){var targetDictName=inAllJobs[inJobID].target;if(inStatus==eJobDone){if(xmpResource.debug("trackAsyncJobs,asyncJobDone: finished query succesfuly"),1==Object.keys(inValues).length&&1==inAllJobs[inJobID].keys.length&&Object.keys(inValues)[0]!=inAllJobs[inJobID].keys[0])$scope.xmp[targetDictName][inAllJobs[inJobID].keys[0]]=inValues[Object.keys(inValues)[0]];else for(var v in inValues)$scope.xmp[targetDictName][v]=inValues[v];setupLoadStatus($scope.xmp,targetDictName,inAllJobs[inJobID].keys,eADORsLoaded)}else setupLoadStatus($scope.xmp,targetDictName,inAllJobs[inJobID].keys,eADORsFailed),xmpResource.error("trackAsyncJobs,asyncJobDone: failued to finish query");inAllJobs[inJobID].status=!0;var allResolved=!0;for(var job in inAllJobs)allResolved=allResolved&&inAllJobs[job].status;allResolved&&onDoneCB&&onDoneCB(inAllJobs)}if(0==Object.keys(asyncJobs).length)return void(onDoneCB&&onDoneCB());for(var asyncJobID in asyncJobs)asyncJobs[asyncJobID].status=!1;for(var asyncJobID in asyncJobs)void 0!==asyncJobs.initStatus&&asyncJobs.initStatus!=eJobInProgress?asyncJobDone(asyncJobs,asyncJobID,asyncJobs.initStatus,asyncJobs.initValues):asyncWait(asyncJobs,asyncJobID,0)}}function anonymousViewController($scope,$location,$window,$injector,$cookies,$parse,xmpResource,adorDeclareCB,setupDefaultErrorPageCB){commonControllersSetup($scope,$location,$window,$injector,$cookies,$parse,xmpResource,adorDeclareCB,setupDefaultErrorPageCB),$scope.xmp.recipientID=null,$scope.xmp.r={},$scope.setRecipientID=function(inRecipientID){var defaultADORs=Object.keys($scope.defaultAdorsForGet);0!=defaultADORs.length&&(setupLoadStatus($scope.xmp,"r",defaultADORs,eADORsLoading),xmpResource.getRecipientADORs(inRecipientID,{adors:defaultADORs,resolved:Object.keys($scope.defaultAdorsForResolve)}).$promise.then(function(result){$scope.xmp.recipientID=inRecipientID;var resultAnalysis=analyzeGetADORSResponse(result,"r");$scope.xmp.r=result,setupLoadStatus($scope.xmp,"r",resultAnalysis.readyADORs,eADORsLoaded),$scope.trackAsyncJobs(resultAnalysis.asyncJobs),setCookie("xmpRecipientID",$scope.xmp.recipientID,9999)},function(reason){setupLoadStatus($scope.xmp,"r",defaultADORs,eADORsFailed)}))},$scope.rememberRecipient=function(){$cookies.xmpRecipientID&&""!=$cookies.xmpRecipientID&&$scope.setRecipientID($cookies.xmpRecipientID)},$scope.forgetRecipient=function(){var d=new Date(1970,1,1),expires="expires="+d.toUTCString();document.cookie="xmpRecipientID=;"+expires,$scope.xmp.recipientID=null},xmpResource.debug("anonymousViewController: running login only (no retrieve). service token cookie =",$cookies.xmpServiceToken,"recipient id cookie =",$cookies.xmpRecipientID),xmpResource.login($cookies.xmpServiceToken,null,!1).$promise.then(function(result){$cookies.xmpServiceToken=xmpResource.access.serviceToken,recipientReady($scope),referredRecipientSetup($scope,$location,$cookies,xmpResource),$cookies.xmpRecipientID&&$scope.xmp.shouldRememberRecipient&&$scope.setRecipientID($cookies.xmpRecipientID),$scope.formDefaultAdors&&$.each($scope.formDefaultAdors,function(key,value){$scope.xmp.r[key]=value})},function(reason){recipientError($scope,reason),referredRecipientError($scope)}),$scope.addRecipientForFields=function(inFields,inActionParameters,inExtraADORsForRetrieve){if(inFields){var savedADORs={};for(var key in inFields)savedADORs[key]=inActionParameters.xmp.r[key];var getADORs=[];if($scope.defaultAdorsForGet)for(var key in $scope.defaultAdorsForGet)getADORs.push(key);inExtraADORsForRetrieve&&inExtraADORsForRetrieve.forEach(function(key){getADORs.push(key)}),setupLoadStatus($scope.xmp,"r",getADORs,eADORsLoading);var resolvedADORs=[];$scope.defaultAdorsForResolve&&(resolvedADORs=Object.keys($scope.defaultAdorsForResolve)),xmpResource.debug("addRecipientForFields: adding recipient [registration]. saved data =",savedADORs,". data to retrieve = ",getADORs),xmpResource.addRecipient({adors:savedADORs,retrieveADORs:getADORs,resolvedADORs:resolvedADORs}).$promise.then(function(result){console.log("inActionParameters.hasAutoSignIn="+inActionParameters.hasAutoSignIn),inActionParameters.hasAutoSignIn&&setCookie("xmpSecurityToken",result.securityToken,9999),$scope.xmp.recipientID=result.recipientID;var resultAnalysis=analyzeGetADORSResponse(result.values,"r");resultAnalysis.readyADORs.forEach(function(key){$scope.xmp.r[key]=result.values[key]}),setupLoadStatus($scope.xmp,"r",resultAnalysis.readyADORs,eADORsLoaded),$scope.trackAsyncJobs(resultAnalysis.asyncJobs),$cookies.xmpRecipientID=$scope.xmp.recipientID,$scope.xmp.shouldRememberRecipient?setCookie("xmpRecipientID",$scope.xmp.recipientID,9999):setCookie("xmpRecipientID",$scope.xmp.recipientID,.01),$cookies.xmpRecipientID&&""!=$cookies.xmpRecipientID&&$scope.setRecipientID($cookies.xmpRecipientID),delete inActionParameters.xmp,xmpResource.debug("addRecipientForFields: success in adding recipient [registration]. recipient id = ",$scope.xmp.recipientID),onRecipientSubmitSuccess($window,$location,$parse,xmpResource,$scope,inActionParameters)},getFailureCBForRecipientSubmit($location,$parse,$scope,xmpResource,inActionParameters))}}}function XmpResource($resource,$http,$location,$log,inOptions){var self=this;inOptions&&["access","timeout","debugEnabled","dontCacheGets"].forEach(function(inValue){void 0!==inOptions[inValue]&&(self[inValue]=inOptions[inValue])}),this.access||(this.access={}),this.resourceConfig=void 0!==this.timeout?{timeout:this.timeout}:null,this.$resource=$resource,this.$http=$http,this.$location=$location,this.$log=$log}function accessURL(self,inOptions){return inOptions&&inOptions.access?inOptions.access.url?inOptions.access.url:inOptions.access.URL?inOptions.access.URL:self.access.url:self.access.url?self.access.url:self.access.URL}function serviceToken(self,inOptions){return inOptions&&inOptions.access&&inOptions.access.serviceToken?inOptions.access.serviceToken:self.access.serviceToken}function accessToken(self,inOptions){return document.logCB&&document.logCB("accessToken in xmp.js: self.access.accessToken="+self.access.accessToken),inOptions&&inOptions.access&&inOptions.access.accessToken?inOptions.access.accessToken:self.access.accessToken}function resourceToken(self,inOptions){var st=serviceToken(self,inOptions),ret=accessToken(self,inOptions);return st&&st.length>0&&st!=ret&&!document.logCB?ret+"_"+st:ret}function GetCircleTokenEncrypted(){return"undefined"!=typeof CircleTokenEncrypted?(document.logCB&&document.logCB("xmp.js: CircleTokenEncrypted="+CircleTokenEncrypted),CircleTokenEncrypted):(document.logCB&&document.logCB("xmp.js: CircleTokenEncrypted=NULL"),"")}function isTest(self,inOptions){return inOptions&&void 0!==inOptions.test?inOptions.test:self.$location.search().isTest||self.test}function addOptionalLogin(self,inLogin,inParameters){inLogin&&(inParameters.login=!0,inParameters.siteURL=self.$location.absUrl(),inParameters.isTest=isTest(self),
inParameters.cachedServiceToken=inLogin.cached?inLogin.cached.serviceToken:null,inParameters.cachedRecipientID=inLogin.cached?inLogin.cached.recipientID:null)}function fetchURL(self,inURL,inRunWhenFetched,inRunWhenFailed){var req=self.$http.get(inURL,self.resourceConfig);return inRunWhenFetched&&req.success(inRunWhenFetched),inRunWhenFailed&&req.error(inRunWhenFailed),req}function noOp(){}function attributesExcludeCollection(inAttributes){return void 0!==inAttributes.xmpAsync||void 0!==inAttributes["xmp-async"]||void 0!==inAttributes["data-xmp-async"]||void 0!==inAttributes.xmpExcludeLoad||void 0!==inAttributes["xmp-exclude-load"]||void 0!==inAttributes["data-xmp-exclude-load"]}function attributeCanBeCollected(inAttributeName){return"string"==typeof inAttributeName&&inAttributeName.length>0&&"$"!=inAttributeName.charAt(0)&&"xmpLoadAsyncAdor"!=inAttributeName&&"xmp-load-async-ador"!=inAttributeName&&"data-xmp-load-async-ador"!=inAttributeName}function canDebugExternal(){"undefined"!=typeof uCreateXMGlobal&&uCreateXMGlobal.logDebugFromExternalLibrary}function htmlAttrsToPlainKeyValue(inAttrs){var result={};return $.each(inAttrs,function(i,attrib){result[attrib.name]=attrib.value}),result}function shouldExcludeReferredSearch(inAttributes){return!!inAttributes&&(void 0!==inAttributes.xmpRefer||void 0!==inAttributes["xmp-refer"]||void 0!==inAttributes["data-xmp-refer"]||void 0!==inAttributes.xmpReferForm||void 0!==inAttributes["xmp-refer-form"]||void 0!==inAttributes["data-xmp-refer-form"])}function init(self,inDoLogin,inDecipherRecipientID){self.xmpResource=getResource(self,"xmpResource"),inDoLogin&&(self.$cookies=getResource(self,"$cookies")),copyRelevantPrototype(self),inDoLogin?self.xmpResource.login(self.$cookies.xmpServiceToken,self.$cookies.xmpRecipientID,inDecipherRecipientID).$promise.then(function(value){self.recipientID=value.recipientID,setCookie("xmpServiceToken",value.serviceToken,9999),setCookie("xmpRecipientID",value.recipientID,9999),markReady(self)}):markReady(self)}function markReady(self){self.isReady=!0,$(self).trigger("xmpResourceDriverXMPL::ready")}function getResource(self,inName){return self.injector.get(inName)}function isFunction(functionToCheck){var getType={};return functionToCheck&&"[object Function]"===getType.toString.call(functionToCheck)}function copyRelevantPrototype(self){var proto=Object.getPrototypeOf(self.xmpResource);for(var key in proto)if(proto.hasOwnProperty(key)&&isFunction(proto[key])){var obj={key:key};self[key]=function(){return self.xmpResource[this.key].apply(self.xmpResource,arguments)}.bind(obj)}}var xmpDirectives=angular.module("xmp.directives",[]);["src","href","class"].forEach(function(inDirective){var directive="xmp-"+inDirective,camelDirective="xmp"+inDirective.substr(0,1).toUpperCase()+inDirective.substr(1);xmpDirectives.directive(camelDirective,["$compile","xmpResource",function($compile,xmpResource){return{restrict:"A",terminal:!0,priority:1e3,compile:function(inElement,inAttributes,inTransclude){return xmpResource.declareRecipientADORsInJQueryElement(inElement),inElement.attr("ng-"+inDirective,inAttributes[camelDirective]),inElement.removeAttr(directive),inElement.removeAttr("data-"+directive),{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){$compile(iElement)(scope)}}}}}])}),xmpDirectives.directive("xmpShow",["$compile","xmpResource",function($compile,xmpResource){return{restrict:"A",compile:function(inElement,inAttributes){return function(inScope,inElement,inAttributes){inScope.$watch(inAttributes.xmpShow,function(inValue){toBoolean(inValue)?inAttributes.$removeClass("ng-hide"):inAttributes.$addClass("ng-hide")})}}}}]),xmpDirectives.directive("xmpImageAsset",["xmpResource",function(xmpResource){return{restrict:"A",scope:!0,compile:function(element,attrs){return xmpResource.declareRecipientResolvedADORsInExpression(attrs.xmpImageAsset),function(scope,iElement,iAttrs,controller){scope.$watch(attrs.xmpImageAsset,function(value){value&&iAttrs.$set("src",xmpResource.getAssetFetchingURL(value))}),scope.xmpReady(function(){var adorExpression=attrs.xmpImageAsset,adorStatusExpression="xmp.status"+adorExpression.substr(3);if(scope.$eval(adorStatusExpression)==eADORsLoading){createAsyncReplacement(element,attrs);var unregister=scope.$watch(adorStatusExpression,function(value){value!=eADORsLoading&&(destroyAsyncReplacement(element),unregister())})}})}}}}]),xmpDirectives.directive("xmpTextAsset",["xmpResource",function(xmpResource){return{restrict:"A",scope:!0,compile:function(element,attrs){return xmpResource.declareRecipientResolvedADORsInExpression(attrs.xmpTextAsset),function(scope,iElement,iAttrs,controller){scope.$watch(attrs.xmpTextAsset,function(value){value&&xmpResource.fetchAsset(value,{},function(data,status,headers,config){iElement.text(data)})})}}}}]),xmpDirectives.directive("xmpHtmlAsset",["xmpResource",function(xmpResource){return{restrict:"A",scope:!0,compile:function(element,attrs){return xmpResource.declareRecipientResolvedADORsInExpression(attrs.xmpHtmlAsset),function(scope,iElement,iAttrs,controller){scope.$watch(attrs.xmpHtmlAsset,function(value){value&&xmpResource.fetchAsset(value,{},function(data,status,headers,config){iElement.html(data)})})}}}}]),xmpDirectives.directive("xmpRepeat",["$compile","xmpResource",function($compile,xmpResource){return{restrict:"A",terminal:!0,priority:1e3,compile:function(inElement,inAttributes,inTransclude){return xmpResource.declareRecipientADORsInJQueryElement(inElement),inElement.attr("ng-repeat",inAttributes.xmpRepeat),inElement.removeAttr("xmp-repeat"),inElement.removeAttr("data-xmp-repeat"),{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){$compile(iElement)(scope)}}}}}]),xmpDirectives.directive("xmpUpdate",["$compile","xmpResource",function($compile,xmpResource){return{restrict:"A",terminal:!0,priority:999,scope:!0,compile:function(element,attrs){return xmpResource.declareRecipientADORsInJQueryElement(element),element.attr("ng-submit","updateAdors()"),element.removeAttr("xmp-update"),element.removeAttr("data-xmp-update"),{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){$compile(iElement)(scope)}}},controller:function($scope,$element){isolateSuccessFailureProperties($scope),$scope.updateAdors=function(){$scope.updateAdorsForFields($scope.defaultAdorsForSet,$scope)}}}}]),xmpDirectives.directive("xmpRegister",["$compile","xmpResource",function($compile,xmpResource){return{restrict:"A",terminal:!0,priority:999,scope:!0,compile:function(element,attrs){return xmpResource.declareRecipientADORsInJQueryElement(element),element.attr("ng-submit","addRecipient()"),element.removeAttr("xmp-register"),element.removeAttr("data-xmp-register"),element.attr("xmp-register-form","true"),{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){$compile(iElement)(scope)}}},controller:function($scope,$element){isolateSuccessFailureProperties($scope),$scope.hasAutoSignIn=!!$element.attr("xmp-signin-auto"),$scope.addRecipient=function(){var passwordElement=$element.find("[xmp-password]")[0],confirmPasswordElement=$element.find("[xmp-confirm-password]")[0];if(confirmPasswordElement&&passwordElement){var passwordText=passwordElement.value.trim(),confirmPasswordText=confirmPasswordElement.value.trim();if(confirmPasswordText!==passwordText)return $(confirmPasswordElement).addClass("xmp-confirm-error"),void(confirmPasswordElement.getAttribute("xmp-failure-js")&&eval(confirmPasswordElement.getAttribute("xmp-failure-js")))}$scope.addRecipientForFields($scope.defaultAdorsForSet,$scope)}}}}]),xmpDirectives.directive("xmpRefer",["$compile","xmpResource",function($compile,xmpResource){return{restrict:"A",terminal:!0,priority:999,scope:!0,compile:function(element,attrs){return xmpResource.declareRecipientADORsInJQueryElement(element),element.attr("ng-submit","addReferredRecipient()"),element.removeAttr("xmp-refer"),element.removeAttr("data-xmp-refer"),element.attr("xmp-refer-form","true"),{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){var recipientDict={};scope.referDict={},xmpResource.populateRecipientADORsInJQueryElement(element,recipientDict,scope.referDict,!1,!1,!0),scope.xmpReady(function(){scope.resetXMP()}),$compile(iElement)(scope)}}},controller:function($scope,$element){isolateSuccessFailureProperties($scope),$scope.resetXMP=function(){var xmpCopy={};for(var key in this.xmp)this.xmp.hasOwnProperty(key)&&(xmpCopy[key]=this.xmp[key]);this.xmp=xmpCopy,this.xmp.referredRecipient={};var referReci=this.xmp.referredRecipient={};this.$parent.formDefaultReferredAdors&&$.each(this.$parent.formDefaultReferredAdors,function(key,value){referReci[key]=value})},$scope.addReferredRecipient=function(){var passwordElement=$element.find("[xmp-password]")[0],confirmPasswordElement=$element.find("[xmp-confirm-password]")[0];if(confirmPasswordElement&&passwordElement){var passwordText=passwordElement.value.trim(),confirmPasswordText=confirmPasswordElement.value.trim();if(confirmPasswordText!==passwordText)return $(confirmPasswordElement).addClass("xmp-confirm-error"),void(confirmPasswordElement.getAttribute("xmp-failure-js")&&eval(confirmPasswordElement.getAttribute("xmp-failure-js")))}$scope.addReferredRecipientForFields($scope.defaultAdorsForReferredAdd,$scope,Object.keys($scope.referDict))}}}}]),xmpDirectives.directive("xmpSuccessTriggeredEmail",["xmpResource",function(xmpResource){return{restrict:"A",priority:1e3,compile:function(element,attrs){return xmpResource.declareRecipientADORsInAttributes(attrs),function(scope,iElement,iAttrs,controller){isActionContainer(iElement,iAttrs)?(scope.successEmail={id:iAttrs.xmpSuccessTriggeredEmail,customizations:{}},["xmpSubject","xmpFrom","xmpFromName","xmpReplyTo","xmpTo","xmpToName","xmpCc","xmpCcName","xmpBcc","xmpBccName"].forEach(function(inElement){iAttrs.$observe(inElement,function(value){value&&(scope.successEmail.customizations[inElement]=value)})})):iElement.on("click.xmpSuccessTriggeredEmail",function(){scope.successEmail={id:iAttrs.xmpSuccessTriggeredEmail,customizations:{}},["xmpSubject","xmpFrom","xmpFromName","xmpReplyTo","xmpTo","xmpToName","xmpCc","xmpCcName","xmpBcc","xmpBccName"].forEach(function(inElement){scope.successEmail.customizations[inElement]=iAttrs[inElement]})})}}}}]),xmpDirectives.directive("xmpSuccessUrl",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpSuccessUrl","successURL")}}}),xmpDirectives.directive("xmpFailureUrl",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpFailureUrl","failureURL")}}}),xmpDirectives.directive("xmpSuccessTrackAction",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpSuccessTrackAction","successTrackAction")}}}),xmpDirectives.directive("xmpFailureTrackAction",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpFailureTrackAction","failureTrackAction")}}}),xmpDirectives.directive("xmpSuccessJs",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpSuccessJs","successJSAction")}}}),xmpDirectives.directive("xmpSuccessNg",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpSuccessNg","successNGAction")}}}),xmpDirectives.directive("xmpFailureJs",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpFailureJs","failureJSAction")}}}),xmpDirectives.directive("xmpFailureNg",function(){return{restrict:"A",priority:1e3,link:function(scope,iElement,iAttrs,controller){activateScopePropertyForFormOrButton(scope,iElement,iAttrs,"xmpFailureNg","failureNGAction")}}}),xmpDirectives.directive("xmpTrueValue",["$compile",function($compile){return{restrict:"A",terminal:!0,priority:1e3,compile:function(inElement,inAttributes,inTransclude){var trueVal=inAttributes.xmpTrueValue;inElement.attr("ng-true-value",trueVal),inElement.removeAttr("xmp-true-value"),inElement.removeAttr("data-xmp-true-value")}}}]),xmpDirectives.directive("xmpFalseValue",["$compile",function($compile){return{restrict:"A",terminal:!0,priority:1e3,compile:function(inElement,inAttributes,inTransclude){var falseVal=inAttributes.xmpFalseValue;inElement.attr("ng-false-value",falseVal),inElement.removeAttr("xmp-false-value"),inElement.removeAttr("data-xmp-false-value")}}}]),xmpDirectives.directive("xmpWriteAdor",["$compile","xmpResource",function($compile,xmpResource){return{restrict:"A",terminal:!0,priority:1e3,require:"?ngModel",compile:function(inElement,inAttributes,inTransclude){var ador=inAttributes.xmpWriteAdor;inElement.attr("ng-model",ador),inElement.removeAttr("xmp-write-ador"),inElement.removeAttr("data-xmp-write-ador");var adorDefaultValue=inAttributes.xmpDefaultValue;return adorDefaultValue&&(inElement.removeAttr("xmp-default-value"),inElement.removeAttr("data-xmp-default-value")),{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){$compile(iElement)(scope),scope.defaultAdorsForSet||(scope.defaultAdorsForSet={}),scope.defaultAdorsForReferredAdd||(scope.defaultAdorsForReferredAdd={}),scope.$parent.formDefaultAdors||(scope.$parent.formDefaultAdors={}),scope.$parent.formDefaultReferredAdors||(scope.$parent.formDefaultReferredAdors={}),adorDefaultValue&&xmpResource.populateRecipientADORsInExpression(ador,scope.$parent.formDefaultAdors,scope.$parent.formDefaultReferredAdors,!1,!1,adorDefaultValue),xmpResource.populateRecipientADORsInExpression(ador,scope.defaultAdorsForSet,scope.defaultAdorsForReferredAdd),void 0!==iAttrs.value&&scope.xmpReady(function(){"radio"!=iAttrs.type&&iElement.controller("ngModel").$setViewValue(iElement.val())})}}}}}]),xmpDirectives.directive("xmpTrackingPageName",["xmpResource","$window",function(xmpResource,$window){return{restrict:"A",compile:function(inElement,inAttributes,inTransclude){return xmpResource.trackingPageName=inAttributes.xmpTrackingPageName,xmpResource.trackOnPageLoad=!0,function(scope,inElement,inAttributes,controller){function trackLeave(){loadedTime&&(scope.trackingPageName?xmpResource.trackEvent("Page Leave",{sync:!0,recipientID:scope.xmp.recipientID,properties:xmpResource.addDefaultTrackingParameters({PageName:scope.trackingPageName,ActionName:"Page Leave",ActionParams:(((new Date).getTime()-loadedTime)/1e3).toString()})}):xmpResource.error("xmpTrackingPageName, leave: cannot track. tracking page name was not assigned "),loadedTime=null)}var loadedTime=(new Date).getTime();$($window).on("beforeunload",trackLeave),scope.$on("$destory",trackLeave)}}}}]),xmpDirectives.directive("xmpTrackingAction",["xmpResource",function(xmpResource){return{restrict:"A",link:function(scope,iElement,iAttrs,controller){iElement.on(getHTMLEventForTrackingForElement(iElement)+".xmpTrackingAction",function(){var trackingParameters=iAttrs.xmpTrackingAction.split(","),elementTrackingName=trackingParameters.length>0?trackingParameters[0]:getDefaultTrackingElementName(iElement),eventType=trackingParameters.length>1?trackingParameters[1]:getDefaultTrackingEventType(iElement),actionParameters=trackingParameters.length>2?trackingParameters[2]:null,isAnchor="a"==this.tagName.toLowerCase();!actionParameters&&isAnchor&&(actionParameters=iElement[0].href),scope.trackingPageName?xmpResource.trackEvent(eventType,{recipientID:scope.xmp.recipientID,properties:xmpResource.addDefaultTrackingParameters({PageName:scope.trackingPageName,ActionName:elementTrackingName,ActionParams:actionParameters}),sync:isAnchor}):xmpResource.error("xmpTrackingAction: cannot track. tracking page name was not assigned ")})}}}]),xmpDirectives.directive("xmpFacebookShare",["$compile","xmpResource",function($compile,xmpResource){return{restrict:"EA",scope:!0,compile:function(element,attrs){if(xmpResource.declareRecipientADORsInAttributes(attrs),element.is("xmp-facebook-share")){var btn=$(document.createElement("button"));btn.attr("type","button"),element.append(btn),btn.addClass("xmp-facebook-share-btn btn")}return function(inScope,inElement,inAttributes){inElement.on("click.xmpFacebookShare",function(){inScope.postToFacebookFeed()}),["xmpAppid","xmpCaption","xmpDescription","xmpTargetLink","xmpName","xmpThumbnail"].forEach(function(inElement){inAttributes.$observe(inElement,function(value){value&&(inScope[inElement]=value)})}),inScope.$watch(inAttributes.xmpThumbnailAsset,function(value){value&&(inScope.xmpThumbnailAsset=xmpResource.getAssetFetchingURL(value))}),inScope.postToFacebookFeed=function(){var self=this;runFBActionIfInit(this.xmpAppid,function(){xmpResource.debug("xmpFacebookShare,postToFacebookFeed: running facebook ui action with app id =",self.xmpAppid),FB.ui({method:"feed",link:self.xmpTargetLink,name:self.xmpName,caption:self.xmpCaption,description:self.xmpDescription,picture:self.xmpThumbnailAsset?self.xmpThumbnailAsset:self.xmpThumbnail},function(){})})}}}}}]),xmpDirectives.directive("xmpTwitterShare",["$compile","$window","xmpResource",function($compile,$window,xmpResource){return{restrict:"EA",compile:function(element,attrs){xmpResource.declareRecipientADORsInAttributes(attrs);var theElement,isElement=element.is("xmp-twitter-share");return isElement?(theElement=$(document.createElement("a")),theElement.append("Tweet"),element.append(theElement)):theElement=element,theElement.attr("href","https://twitter.com/share"),theElement.attr("data-url",attrs.xmpUrl),theElement.attr("data-text",attrs.xmpSharedText),function(inScope,inElement,inAttributes){[{key:"xmpUrl",value:"data-url"},{key:"xmpSharedText",value:"data-text"}].forEach(function(inObject){inAttributes.$observe(inObject.key,function(value){theElement.attr(inObject.value,value)})}),inScope.xmpReady(function(){$window.setTimeout(function(){theElement.addClass("twitter-share-button"),"undefined"!=typeof twttr&&twttr.widgets.load()},0)}),function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];d.getElementById(id)||(js=d.createElement(s),js.id=id,js.src="https://platform.twitter.com/widgets.js",fjs.parentNode.insertBefore(js,fjs))}(document,"script","twitter-wjs")}}}}]);var eADORsLoading="loading",eADORsLoaded="loaded",eADORsFailed="failed",eJobDone=0,eJobInProgress=1,eJobFailed=2;xmpDirectives.directive("xmpAsync",["xmpResource","$window",function(xmpResource,$window,$injector){return{restrict:"A",scope:!0,link:function(scope,inElement,inAttributes,controller){scope.asyncRecipientADORs={},scope.asyncReferredRecipientADORs={},$.each(inElement[0].attributes,function(i,attrib){xmpResource.populateRecipientADORsInExpression(attrib.value,scope.asyncRecipientADORs,scope.asyncReferredRecipientADORs)}),loadAsync(scope,inElement,inAttributes,controller,xmpResource,$window),scope.$on("xmpRecipientUpdate",function(){loadAsync(scope,inElement,inAttributes,controller,xmpResource,$window)})}}}]),xmpDirectives.directive("xmpLoadAsyncAdor",["xmpResource","$window",function(xmpResource,$window,$injector){return{restrict:"A",scope:!0,link:function(scope,inElement,inAttributes,controller){scope.asyncRecipientADORs={},scope.asyncReferredRecipientADORs={},xmpResource.populateRecipientADORsInExpression(inAttributes.xmpLoadAsyncAdor,scope.asyncRecipientADORs,scope.asyncReferredRecipientADORs),loadAsyncAdor(scope,inElement,inAttributes,controller,xmpResource,$window),scope.$on("xmpRecipientUpdate",function(){loadAsyncAdor(scope,inElement,inAttributes,controller,xmpResource,$window)})}}}]);var kPDFOnDemandStatuses=["initial","completed","in progress","failed"];xmpDirectives.directive("xmppdfondemand",["xmpResource","$window","$compile",function(xmpResource,$window,$compile){return{restrict:"E",scope:!0,compile:function(inElement,inAttributes,inTransclude){return-1==inElement.html().search(/[^\s\\]/)?(inElement.append("<xmpdefaultgenerateview/>"),null):null},controller:function($scope,$element){function documentGenerationJobWait(inRetriesCount){xmpResource.debug("xmppdfondemand,documentGenerationJobWait job",$scope.jobID,"still in progress. retries count =",inRetriesCount),xmpResource.getGenerationJobStatus({jobID:$scope.jobID}).$promise.then(function(result){$scope.status=stringOfStatus(result.status),result.status==eJobInProgress?window.setTimeout(function(){documentGenerationJobWait(inRetriesCount+1)},$scope.asyncWaitTime):documentGenerationJobDone(result)},function(){$scope.status=stringOfStatus(eJobFailed),$scope.downloadURL=null,$scope.errorMessage="xmppdfondemand,generateDocument: request failure",xmpResource.error("xmppdfondemand,generateDocument: request failure")})}function documentGenerationJobDone(inResult){inResult.status==eJobDone?(xmpResource.debug("xmppdfondemand,documentGenerationJobDone succesfuly finished document generation job. file id for download =",inResult.generatedFileID),$scope.downloadURL=xmpResource.getGeneratedFileFetchingURL({fileID:inResult.generatedFileID}),$scope.errorMessage=null):($scope.downloadURL=null,$scope.errorMessage=inResult.errorMessage,xmpResource.error("xmppdfondemand,documentGenerationJobDone failed document generation. message =",inResult.errorMessage))}$scope.status=stringOfStatus(-1),$scope.documentID=$element.attr("xmp-document-ID")||$element.attr("data-xmp-document-ID"),$scope.buttonTitle=$element.attr("xmp-button-title")||$element.attr("data-xmp-button-title"),$scope.generateDocument=function(){$scope.status=stringOfStatus(eJobInProgress),xmpResource.debug("xmppdfondemand,generateDocument: starting document generation job for recipient",$scope.xmp.recipientID,"and document id",$scope.documentID),xmpResource.startGenerationJob($scope.documentID,{recipientID:$scope.xmp.recipientID}).$promise.then(function(result){$scope.status=stringOfStatus(result.status),$scope.jobID=result.jobID,xmpResource.debug("xmppdfondemand,generateDocument: job id is",$scope.jobID),result.status==eJobInProgress?documentGenerationJobWait(0):documentGenerationJobDone(result)},function(){$scope.status=stringOfStatus(eJobFailed),$scope.downloadURL=null,$scope.errorMessage="xmppdfondemand,generateDocument: request failure",xmpResource.error("xmppdfondemand,generateDocument: request failure")})}}}}]),xmpDirectives.directive("xmpdefaultgenerateview",function(){return{replace:!0,restrict:"E",require:"^xmppdfondemand",template:'<div class="xmp-default-generate-view"><span class="xmp-button-on-demand"><button type="button" class="btn" ng-click="generateDocument()" ng-class="{\'xmp-hide\':status==\'in progress\'}">{{buttonTitle}}</button><span class="xmp-busy-on-demand" ng-show="status==\'in progress\'"></span></span><iframe style="display:none" width="1" height="1" frameborder="0" ng-src="{{downloadURL | trustAsResourceUrl}}"></iframe><span ng-show="status==\'failed\'">An error occured, please try again later</span></div>'}}),xmpDirectives.directive("xmpEmail",["xmpResource",function(xmpResource){return{restrict:"E",compile:function(element,attrs){return xmpResource.declareRecipientADORsInAttributes(attrs),function(scope,iElement,iAttrs,controller){var theID=iAttrs.id;xmpResource.emails||(xmpResource.emails={}),xmpResource.emails[theID]={touchpoint:iAttrs.xmpTouchpoint,customizations:{}},["xmpSubject","xmpFrom","xmpFromName","xmpReplyTo","xmpTo","xmpToName","xmpCc","xmpCcName","xmpBcc","xmpBccName"].forEach(function(inElement){iAttrs.$observe(inElement,function(value){value&&(xmpResource.emails[theID].customizations[inElement]=value)})})}}}}]),xmpDirectives.directive("xmpUnsubscribe",["xmpResource","$parse","$location",function(xmpResource,$parse,$location){return{restrict:"A",link:function(scope,inElement,iAttrs,controller){inElement.on("click.xmpUnsubscribe",function(){xmpResource.changeUnsubscribeStatus(scope,$parse,$location,iAttrs,scope.xmp.recipientID,"false"!=iAttrs.xmpUnsubscribe)})}}}]),xmpDirectives.directive("xmpCloak",function(){return{restrict:"A",priority:1e3,link:function(scope,inElement,iAttrs,controller){scope.xmpReady(function(){inElement.removeAttr("xmp-cloak"),inElement.removeAttr("data-xmp-cloak")})}}}),xmpDirectives.directive("xmpLoadAdorTimeout",["xmpResource",function(xmpResource){return{restrict:"A",compile:function(inElement,inAttributes,inTransclude){xmpResource.timeout=parseInt(inAttributes.xmpLoadAdorTimeout,10)}}}]),xmpDirectives.directive("xmpNoCaching",["xmpResource",function(xmpResource){return{restrict:"A",compile:function(inElement,inAttributes,inTransclude){xmpResource.dontCacheGets=void 0!=inAttributes.xmpNoCaching&&"false"!=inAttributes.xmpNoCaching}}}]),xmpDirectives.directive("xmpClickedTriggeredEmail",["xmpResource",function(xmpResource){return{restrict:"A",compile:function(element,attrs){return xmpResource.declareRecipientADORsInAttributes(attrs),function(scope,iElement,iAttrs,controller){iElement.on("click.xmpClickedTriggeredEmail",function(){var successEmail={id:iAttrs.xmpClickedTriggeredEmail,customizations:{}};["xmpSubject","xmpFrom","xmpFromName","xmpReplyTo","xmpTo","xmpToName","xmpCc","xmpCcName","xmpBcc","xmpBccName"].forEach(function(inElement){successEmail.customizations[inElement]=iAttrs[inElement]}),scope.sendEmailorTriggerToRecipient(successEmail)})}}}}]),xmpDirectives.directive("xmpClickedTrigger",["xmpResource",function(xmpResource){return{restrict:"A",compile:function(element,attrs){return xmpResource.declareRecipientADORsInAttributes(attrs),function(scope,iElement,iAttrs,controller){iElement.on("click.xmpClickedTrigger",function(){var successEmail={id:iAttrs.xmpClickedTrigger,customizations:{}};["xmpSubject","xmpFrom","xmpFromName","xmpReplyTo","xmpTo","xmpToName","xmpCc","xmpCcName","xmpBcc","xmpBccName"].forEach(function(inElement){successEmail.customizations[inElement]=iAttrs[inElement]}),scope.sendEmailorTriggerToRecipient(successEmail)})}}}}]),xmpDirectives.directive("xmpSuccessTrigger",["xmpResource",function(xmpResource){return{restrict:"A",priority:1e3,compile:function(element,attrs){return xmpResource.declareRecipientADORsInAttributes(attrs),function(scope,iElement,iAttrs,controller){isActionContainer(iElement,iAttrs)?(scope.successEmailTrigger={id:iAttrs.xmpSuccessTrigger,customizations:{}},["xmpSubject","xmpFrom","xmpFromName","xmpReplyTo","xmpTo","xmpToName","xmpCc","xmpCcName","xmpBcc","xmpBccName"].forEach(function(inElement){iAttrs.$observe(inElement,function(value){value&&(scope.successEmailTrigger.customizations[inElement]=value)})})):iElement.on("click.xmpSuccessTrigger",function(){scope.successEmailTrigger={id:iAttrs.xmpSuccessTrigger,customizations:{}},["xmpSubject","xmpFrom","xmpFromName","xmpReplyTo","xmpTo","xmpToName","xmpCc","xmpCcName","xmpBcc","xmpBccName"].forEach(function(inElement){scope.successEmailTrigger.customizations[inElement]=iAttrs[inElement]})})}}}}]),xmpDirectives.directive("xmpUpdateOnPageLoad",["xmpResource",function(xmpResource){return{restrict:"E",compile:function(inElement,inAttributes){xmpResource.adorsToSetOnLoad||(xmpResource.adorsToSetOnLoad={});var adorName=getRecipientADORName(xmpResource,inAttributes.xmpAdor);return adorName?(xmpResource.adorsToSetOnLoad[adorName]=inAttributes.xmpValue,function(inScope,inElement,inAttributes){var unregister=inAttributes.$observe("xmpValue",function(value){if(!xmpResource.adorsToSetOnLoad)return void unregister();xmpResource.adorsToSetOnLoad[adorName]=value})}):null}}}]),xmpDirectives.directive("xmpLoadAdor",["xmpResource",function(xmpResource){return{restrict:"A",compile:function(inElement,inAttributes,inTransclude){xmpResource.declareRecipientADORsInExpression(inAttributes.xmpLoadAdor)}}}]),xmpDirectives.directive("xmpTurnOffDefaultError",["xmpResource",function(xmpResource){return{restrict:"A",compile:function(inElement,inAttributes,inTransclude){xmpResource.turnOffDefaultErrorPage=void 0!=inAttributes.xmpTurnOffDefaultError&&"false"!=inAttributes.xmpTurnOffDefaultError}}}]),xmpDirectives.directive("xmpDefaultErrorNode",[function(){return{restrict:"C",template:'<div ng-if="xmp.errorReason" class="xmp-default-error-display"><h1>XMPL error {{hide111}}</h1><p style="color: red;font-size: 18px;">{{xmp.errorReason.data.DisplayMessage.length > 0 ? xmp.errorReason.data.DisplayMessage : xmp.errorReason.data.ExceptionMessage}}</p><h2>Error details</h2><p>{{specificErrorDetails(xmp.errorReason)}}</p><h2>HTTP error data</h2><h3>Source:</h3><ul><li><strong>url:</strong> {{xmp.errorReason.config.url}}</li><li ng-show="xmp.errorReason.config.params"><strong>query string parameters:</strong><pre>{{(xmp.errorReason.config.params)}}</pre></li><li ng-show="xmp.errorReason.config.data"><strong>body:</strong> <code>{{(xmp.errorReason.config.data)}}</code></li></ul><h3>Result:</h3><ul><li><strong>status:</strong> {{xmp.errorReason.status}}</li><li><strong>data:</strong> {{(xmp.errorReason.data)}}</li></ul><h2>HTTP object</h2><p>{{(xmp.errorReason)}}</p><p style="border: 1px solid black; width: 960px; padding: 5px;">An error occurred while performing a call to XMPL Server. <br />This is a generic view that appears during such errors, providing details about the error. <br />If you want it not to appear in case of error add the attribute <code>xmp-turn-off-default-error</code> to the element containing the <code>ng-controller</code> attribute.   </p></div>',link:function($scope,$element,inAttributes){$scope.specificErrorDetails=function(reason){return getSpecificErrorDetails(reason)},$scope.$watch("xmp.errorReason",function(inValue){var controllerElement=$element.parent();$internalMain=$element.children().first(),$internalMain.width(controllerElement.width()),$internalMain.css("min-height",controllerElement.height()),$internalMain.offset(controllerElement.offset())})}}}]),xmpDirectives.directive("xmpRememberRecipient",[function(){return{restrict:"A",link:function(scope,element,attr){attr.ngController&&"XMPAnonymousPage"==attr.ngController&&(scope.xmp.shouldRememberRecipient=!0)}}}]),xmpDirectives.directive("xmpSignin",["$compile","xmpResource","$location",function($compile,xmpResource,$location){return{restrict:"A",terminal:!0,priority:999,scope:!0,compile:function(element,attrs){xmpResource.declareRecipientADORsInJQueryElement(element),element.attr("ng-submit","submitLogin()"),element.removeAttr("xmp-signin"),element.removeAttr("data-xmp-signin");var username=element.find("[xmp-username]");username?username.attr("ng-model","username"):console.error("missing xmp-username directive inside xmp-signin");var password=element.find("[xmp-password]");return password?password.attr("ng-model","password"):console.error("missing xmp-password directive inside xmp-signin"),{pre:function(scope,iElement,iAttrs,controller){},post:function(scope,iElement,iAttrs,controller){scope.username="",scope.password="",$compile(iElement)(scope)}}},controller:function($scope,$element){isolateSuccessFailureProperties($scope);var failureAttrElement=$element.find("[xmp-signin-status-class]");window.xmpSigninOnPage=1,$scope.submitLogin=function(){xmpResource.signin($scope.xmp.recipientID,$scope.username,$scope.password,$scope.successURL,$scope.failureJSAction,failureAttrElement,$location,$scope)}}}}]),xmpDirectives.directive("xmpSignout",["$compile","xmpResource","$location",function($compile,xmpResource,$location){return{restrict:"A",terminal:!0,priority:999,scope:!0,compile:function(element,attrs){return xmpResource.declareRecipientADORsInJQueryElement(element),element.attr("ng-click","submitLogout()"),element.removeAttr("xmp-signout"),element.removeAttr("data-xmp-signout"),{pre:function(scope,iElement,iAttrs,controller){},
post:function(scope,iElement,iAttrs,controller){$compile(iElement)(scope)}}},controller:function($scope,$element){isolateSuccessFailureProperties($scope),$scope.submitLogout=function(){xmpResource.signOut($scope.xmp.recipientID,$scope.successURL||$element.attr("xmp-success-url"),$location,$scope)}}}}]),xmpDirectives.directive("xmpClear",function(){return{restrict:"A",terminal:!0,priority:999,scope:!0,link:function(scope,element){element.click(function(){deleteAllXmpCookies()})}}});var deleteAllXmpCookies=function(){deleteCookie("xmpSecurityToken"),deleteCookie("xmpRecipientID"),deleteCookie("xmpServiceToken"),deleteCookie("xmpReferredID")},xmpControllers=angular.module("xmp.controllers",["ngCookies"]);xmpControllers.filter("trustAsResourceUrl",["$sce",function($sce){return function(val){return $sce.trustAsResourceUrl(val)}}]);var eADORsLoading="loading",eADORsLoaded="loaded",eADORsFailed="failed",eJobDone=0,eJobInProgress=1,eJobFailed=2,deleteCookie=function(name){document.cookie=name+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"};xmpControllers.controller("XMPPersonalizedPage",["$scope","$element","$location","$window","$injector","$cookies","$parse","$compile","xmpResource",function($scope,$element,$location,$window,$injector,$cookies,$parse,$compile,xmpResource){personalizedViewController($scope,$location,$window,$injector,$cookies,$parse,xmpResource,function(){xmpResource.declareRecipientADORsInJQueryElement($element),xmpResource.debug("XMPPersonalizedPage: Scanning ADORs on $element")},function(){createDefaultErrorNode($element,$compile,$scope),xmpResource.debug("XMPPersonalizedPage: creating default error element")})}]),xmpControllers.controller("XMPPersonalizedView",["$scope","$location","$window","$injector","$cookies","$parse","$rootElement","xmpResource",function($scope,$location,$window,$injector,$cookies,$parse,$rootElement,xmpResource){personalizedViewController($scope,$location,$window,$injector,$cookies,$parse,xmpResource,function(){var $ngView=$rootElement.find("[ng-view]");$ngView.length>0?(xmpResource.declareRecipientADORsInJQueryElement($ngView),xmpResource.debug("XMPPersonalizedView: Scanning ADORs on $ngView")):xmpResource.debug("XMPPersonalizedView: $ngView not found, not scanning for ADORs")},function(){})}]),xmpControllers.controller("XMPAnonymousPage",["$scope","$element","$location","$window","$injector","$cookies","$parse","$compile","xmpResource",function($scope,$element,$location,$window,$injector,$cookies,$parse,$compile,xmpResource){anonymousViewController($scope,$location,$window,$injector,$cookies,$parse,xmpResource,function(){xmpResource.declareRecipientADORsInJQueryElement($element),xmpResource.debug("XMPAnonymousPage: Scanning ADORs on $element")},function(){createDefaultErrorNode($element,$compile,$scope),xmpResource.debug("XMPAnonymousPage: creating default error element")})}]),xmpControllers.controller("XMPAnonymousView",["$scope","$location","$window","$injector","$cookies","$parse","$rootElement","xmpResource",function($scope,$location,$window,$injector,$cookies,$parse,$rootElement,xmpResource){anonymousViewController($scope,$location,$window,$injector,$cookies,$parse,xmpResource,function(){var $ngView=$rootElement.find("[ng-view]");$ngView.length>0?(xmpResource.declareRecipientADORsInJQueryElement($ngView),xmpResource.debug("XMPAnonymousView: Scanning ADORs on $ngView")):xmpResource.debug("XMPAnonymousView: $ngView not found, not scanning for ADORs")},function(){})}]),function(){"use strict";function capitalize(string){return string=String(string),string.charAt(0).toUpperCase()+string.slice(1)}function each(object,callback){var index=-1,length=object?object.length:0;if("number"==typeof length&&length>-1&&length<=maxSafeInteger)for(;++index<length;)callback(object[index],index,object);else forOwn(object,callback)}function format(string){return string=trim(string),/^(?:webOS|i(?:OS|P))/.test(string)?string:capitalize(string)}function forOwn(object,callback){for(var key in object)hasOwnProperty.call(object,key)&&callback(object[key],key,object)}function getClassOf(value){return null==value?capitalize(value):toString.call(value).slice(8,-1)}function isHostType(object,property){var type=null!=object?typeof object[property]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(type)||"object"==type&&!object[property])}function qualify(string){return String(string).replace(/([ -])(?!$)/g,"$1?")}function reduce(array,callback){var accumulator=null;return each(array,function(value,index){accumulator=callback(accumulator,value,index,array)}),accumulator}function trim(string){return String(string).replace(/^ +| +$/g,"")}function parse(ua){function getProduct(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+" *\\d+[.\\w_]*","i").exec(ua)||RegExp("\\b"+pattern+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(ua))&&((result=String(guess.label&&!RegExp(pattern,"i").test(guess.label)?guess.label:result).split("/"))[1]&&!/[\d.]+/.test(result[0])&&(result[0]+=" "+result[1]),guess=guess.label||guess,result=format(result[0].replace(RegExp(pattern,"i"),guess).replace(RegExp("; *(?:"+guess+"[_-])?","i")," ").replace(RegExp("("+guess+")[-_.]?(\\w)","i"),"$1 $2"))),result})}function toStringPlatform(){return this.description||""}var context=root,isCustomContext=ua&&"object"==typeof ua&&"String"!=getClassOf(ua);isCustomContext&&(context=ua,ua=null);var nav=context.navigator||{},userAgent=nav.userAgent||"";ua||(ua=userAgent);var data,isModuleScope=isCustomContext||thisBinding==oldRoot,likeChrome=isCustomContext?!!nav.likeChrome:/\bChrome\b/.test(ua)&&!/internal|\n/i.test(toString.toString()),airRuntimeClass=isCustomContext?"Object":"ScriptBridgingProxyObject",enviroClass=isCustomContext?"Object":"Environment",javaClass=isCustomContext&&context.java?"JavaPackage":getClassOf(context.java),phantomClass=isCustomContext?"Object":"RuntimeObject",java=/Java/.test(javaClass)&&context.java,rhino=java&&getClassOf(context.environment)==enviroClass,alpha=java?"a":"α",beta=java?"b":"β",doc=context.document||{},opera=context.operamini||context.opera,operaClass=reOpera.test(operaClass=isCustomContext&&opera?opera["[[Class]]"]:getClassOf(opera))?operaClass:opera=null,arch=ua,description=[],prerelease=null,useFeatures=ua==userAgent,version=useFeatures&&opera&&"function"==typeof opera.version&&opera.version(),layout=function(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}([{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","Trident","KHTML","Gecko"]),name=function(guesses){return reduce(guesses,function(result,guess){return result||RegExp("\\b"+(guess.pattern||qualify(guess))+"\\b","i").exec(ua)&&(guess.label||guess)})}(["Adobe AIR","Arora","Avant Browser","Camino","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel",{label:"SRWare Iron",pattern:"Iron"},"K-Meleon","Konqueror","Lunascape","Maxthon","Midori","Nook Browser","PhantomJS","Raven","Rekonq","RockMelt","SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser","Sunrise","Swiftfox","WebPositive","Opera Mini","Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"IE",pattern:"MSIE"},"Safari"]),product=getProduct([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},"Google TV","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nook","PlayBook","PlayStation 4","PlayStation 3","PlayStation Vita","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),manufacturer=function(guesses){return reduce(guesses,function(result,value,key){return result||(value[product]||value[/^[a-z]+(?: +[a-z]+\b)*/i.exec(product)]||RegExp("\\b"+qualify(key)+"(?:\\b|\\w*\\d)","i").exec(ua))&&key})}({Apple:{iPad:1,iPhone:1,iPod:1},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{"PlayStation 4":1,"PlayStation 3":1,"PlayStation Vita":1}}),os=function(guesses){return reduce(guesses,function(result,guess){var pattern=guess.pattern||qualify(guess);return!result&&(result=RegExp("\\b"+pattern+"(?:/[\\d.]+|[ \\w.]*)","i").exec(ua))&&(data={6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"},/^Win/i.test(result)&&(data=data[/[\d.]+$/.exec(result)])&&(result="Windows "+data),result=format(String(result).replace(RegExp(pattern,"i"),guess.label||guess).replace(/ ce$/i," CE").replace(/hpw/i,"web").replace(/Macintosh/,"Mac OS").replace(/_PowerPC/i," OS").replace(/(OS X) [^ \d]+/i,"$1").replace(/Mac (OS X)/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/x86\.64/gi,"x86_64").split(" on ")[0])),result})}(["Android","CentOS","Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);if(layout&&(layout=[layout]),manufacturer&&!product&&(product=getProduct([manufacturer])),(data=/Google TV/.exec(product))&&(product=data[0]),/\bSimulator\b/i.test(ua)&&(product=(product?product+" ":"")+"Simulator"),/^iP/.test(product)?(name||(name="Safari"),os="iOS"+((data=/ OS ([\d_]+)/i.exec(ua))?" "+data[1].replace(/_/g,"."):"")):"Konqueror"!=name||/buntu/i.test(os)?manufacturer&&"Google"!=manufacturer&&(/Chrome/.test(name)&&!/Mobile Safari/.test(ua)||/Vita/.test(product))?(name="Android Browser",os=/Android/.test(os)?os:"Android"):name&&!(data=!/\bMinefield\b|\(Android;/i.test(ua)&&/Firefox|Safari/.exec(name))||(name&&!product&&/[\/,]|^[^(]+?\)/.test(ua.slice(ua.indexOf(data+"/")+8))&&(name=null),(data=product||manufacturer||os)&&(product||manufacturer||/Android|Symbian OS|Tablet OS|webOS/.test(os))&&(name=/[a-z]+(?: Hat)?/i.exec(/Android/.test(os)?os:data)+" Browser")):os="Kubuntu",(data=/\((Mobile|Tablet).*?Firefox/i.exec(ua))&&data[1]&&(os="Firefox OS",product||(product=data[1])),version||(version=function(patterns){return reduce(patterns,function(result,pattern){return result||(RegExp(pattern+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(ua)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Iron|Opera ?Mini|OPR|Raven|Silk(?!/[\\d.]+$))","Version",qualify(name),"(?:Firefox|Minefield|NetFront)"])),"iCab"==layout&&parseFloat(version)>3?layout=["WebKit"]:(data=/Opera/.test(name)&&(/OPR/.test(ua)?"Blink":"Presto")||/\b(?:Midori|Nook|Safari)\b/i.test(ua)&&"WebKit"||!layout&&/\bMSIE\b/i.test(ua)&&("Mac OS"==os?"Tasman":"Trident"))?layout=[data]:/PlayStation(?! Vita)/i.test(name)&&"WebKit"==layout&&(layout=["NetFront"]),name||"Trident"!=layout||(name="IE",version=(/\brv:([\d.]+)/.exec(ua)||0)[1]),useFeatures){if(isHostType(context,"global"))if(java&&(data=java.lang.System,arch=data.getProperty("os.arch"),os=os||data.getProperty("os.name")+" "+data.getProperty("os.version")),isHostType(context,"exports"))if(isModuleScope&&isHostType(context,"system")&&(data=[context.system])[0]){os||(os=data[0].os||null);try{data[1]=(data[1]=context.require)&&data[1]("ringo/engine").version,version=data[1].join("."),name="RingoJS"}catch(e){data[0].global.system==context.system&&(name="Narwhal")}}else"object"==typeof context.process&&(data=context.process)?(name="Node.js",arch=data.arch,os=data.platform,version=/[\d.]+/.exec(data.version)[0]):rhino&&(name="Rhino");else rhino&&(name="Rhino");else getClassOf(data=context.runtime)==airRuntimeClass?(name="Adobe AIR",os=data.flash.system.Capabilities.os):getClassOf(data=context.phantom)==phantomClass?(name="PhantomJS",version=(data=data.version||null)&&data.major+"."+data.minor+"."+data.patch):"number"==typeof doc.documentMode&&(data=/\bTrident\/(\d+)/i.exec(ua))&&(version=[version,doc.documentMode],(data=+data[1]+4)!=version[1]&&(description.push("IE "+version[1]+" mode"),layout&&(layout[1]=""),version[1]=data),version="IE"==name?String(version[1].toFixed(1)):version[0]);os=os&&format(os)}version&&(data=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(version)||/(?:alpha|beta)(?: ?\d)?/i.exec(ua+";"+(useFeatures&&nav.appMinorVersion))||/\bMinefield\b/i.test(ua)&&"a")&&(prerelease=/b/i.test(data)?"beta":"alpha",version=version.replace(RegExp(data+"\\+?$"),"")+("beta"==prerelease?beta:alpha)+(/\d+\+?/.exec(data)||"")),"Fennec"==name||"Firefox"==name&&/Android|Firefox OS/.test(os)?name="Firefox Mobile":"Maxthon"==name&&version?version=version.replace(/\.[\d.]+/,".x"):"Silk"==name?(/Mobi/i.test(ua)||(os="Android",description.unshift("desktop mode")),/Accelerated *= *true/i.test(ua)&&description.unshift("accelerated")):"IE"==name&&(data=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(ua)||0)[1])?(name+=" Mobile",os="Windows Phone OS "+data+".x",description.unshift("desktop mode")):/Xbox/i.test(product)?(os=null,"Xbox 360"==product&&/IEMobile/.test(ua)&&description.unshift("mobile mode")):"Chrome"!=name&&"IE"!=name&&(!name||product||/Browser|Mobi/.test(name))||"Windows CE"!=os&&!/Mobi/i.test(ua)?"IE"==name&&useFeatures&&null===context.external?description.unshift("platform preview"):(/BlackBerry/.test(product)||/BB10/.test(ua))&&(data=(RegExp(product.replace(/ +/g," *")+"/([.\\d]+)","i").exec(ua)||0)[1]||version)?(data=[data,/BB10/.test(ua)],os=(data[1]?(product=null,manufacturer="BlackBerry"):"Device Software")+" "+data[0],version=null):this!=forOwn&&"Wii"!=product&&(useFeatures&&opera||/Opera/.test(name)&&/\b(?:MSIE|Firefox)\b/i.test(ua)||"Firefox"==name&&/OS X (?:\d+\.){2,}/.test(os)||"IE"==name&&(os&&!/^Win/.test(os)&&version>5.5||/Windows XP/.test(os)&&version>8||8==version&&!/Trident/.test(ua)))&&!reOpera.test(data=parse.call(forOwn,ua.replace(reOpera,"")+";"))&&data.name&&(data="ing as "+data.name+((data=data.version)?" "+data:""),reOpera.test(name)?(/IE/.test(data)&&"Mac OS"==os&&(os=null),data="identify"+data):(data="mask"+data,name=operaClass?format(operaClass.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/IE/.test(data)&&(os=null),useFeatures||(version=null)),layout=["Presto"],description.push(data)):name+=" Mobile",(data=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(ua)||0)[1])&&(data=[parseFloat(data.replace(/\.(\d)$/,".0$1")),data],"Safari"==name&&"+"==data[1].slice(-1)?(name="WebKit Nightly",prerelease="alpha",version=data[1].slice(0,-1)):version!=data[1]&&version!=(data[2]=(/\bSafari\/([\d.]+\+?)/i.exec(ua)||0)[1])||(version=null),data[1]=(/\bChrome\/([\d.]+)/i.exec(ua)||0)[1],537.36==data[0]&&537.36==data[2]&&parseFloat(data[1])>=28&&(layout=["Blink"]),useFeatures&&(likeChrome||data[1])?(layout&&(layout[1]="like Chrome"),data=data[1]||(data=data[0],data<530?1:data<532?2:data<532.05?3:data<533?4:data<534.03?5:data<534.07?6:data<534.1?7:data<534.13?8:data<534.16?9:data<534.24?10:data<534.3?11:data<535.01?12:data<535.02?"13+":data<535.07?15:data<535.11?16:data<535.19?17:data<536.05?18:data<536.1?19:data<537.01?20:data<537.11?"21+":data<537.13?23:data<537.18?24:data<537.24?25:data<537.36?26:"Blink"!=layout?"27":"28")):(layout&&(layout[1]="like Safari"),data=data[0],data=data<400?1:data<500?2:data<526?3:data<533?4:data<534?"4+":data<535?5:data<537?6:data<538?7:"7"),layout&&(layout[1]+=" "+(data+="number"==typeof data?".x":/[.+]/.test(data)?"":"+")),"Safari"==name&&(!version||parseInt(version)>45)&&(version=data)),"Opera"==name&&(data=/(?:zbov|zvav)$/.exec(os))?(name+=" ",description.unshift("desktop mode"),"zvav"==data?(name+="Mini",version=null):name+="Mobile"):"Safari"==name&&/Chrome/.exec(layout&&layout[1])&&(description.unshift("desktop mode"),name="Chrome Mobile",version=null,/OS X/.test(os)?(manufacturer="Apple",os="iOS 4.3+"):os=null),version&&0==version.indexOf(data=/[\d.]+$/.exec(os))&&ua.indexOf("/"+data+"-")>-1&&(os=trim(os.replace(data,""))),layout&&!/Avant|Nook/.test(name)&&(/Browser|Lunascape|Maxthon/.test(name)||/^(?:Adobe|Arora|Midori|Phantom|Rekonq|Rock|Sleipnir|Web)/.test(name)&&layout[1])&&(data=layout[layout.length-1])&&description.push(data),description.length&&(description=["("+description.join("; ")+")"]),manufacturer&&product&&product.indexOf(manufacturer)<0&&description.push("on "+manufacturer),product&&description.push((/^on /.test(description[description.length-1])?"":"on ")+product),os&&(data=/ ([\d.+]+)$/.exec(os),os={architecture:32,family:data?os.replace(data[0],""):os,version:data?data[1]:null,toString:function(){var version=this.version;return this.family+(version?" "+version:"")+(64==this.architecture?" 64-bit":"")}}),(data=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(arch))&&!/\bi686\b/i.test(arch)&&(os&&(os.architecture=64,os.family=os.family.replace(RegExp(" *"+data),"")),name&&(/WOW64/i.test(ua)||useFeatures&&/\w(?:86|32)$/.test(nav.cpuClass||nav.platform))&&description.unshift("32-bit")),ua||(ua=null);var platform={};return platform.description=ua,platform.layout=layout&&layout[0],platform.manufacturer=manufacturer,platform.name=name,platform.prerelease=prerelease,platform.product=product,platform.ua=ua,platform.version=name&&version,platform.os=os||{architecture:null,family:null,version:null,toString:function(){return"null"}},platform.parse=parse,platform.toString=toStringPlatform,platform.version&&description.unshift(version),platform.name&&description.unshift(name),os&&name&&(os!=String(os).split(" ")[0]||os!=name.split(" ")[0]&&!product)&&description.push(product?"("+os+")":"on "+os),description.length&&(platform.description=description.join(" ")),platform}var objectTypes={function:!0,object:!0},root=objectTypes[typeof window]&&window||this,oldRoot=root,freeExports=objectTypes[typeof exports]&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&"object"==typeof global&&global;!freeGlobal||freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var maxSafeInteger=Math.pow(2,53)-1,reOpera=/Opera/,thisBinding=this,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,toString=objectProto.toString;"function"==typeof define&&"object"==typeof define.amd&&define.amd?define("platform",[],function(){return parse()}):freeExports&&freeModule?forOwn(parse(),function(value,key){freeExports[key]=value}):root.platform=parse()}.call(this),XmpResource.prototype.login=function(inChachedServiceToken,inCachedRID,inWithRIDDeciphering,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var xmpServer=this.$resource(accessURL(this,inOptions)+"/v1/projects/context",null,{login:{method:"POST"}},this.resourceConfig),self=this,options={accessToken:accessToken(this,inOptions),isTest:isTest(this,inOptions),siteURL:inWithRIDDeciphering?this.$location.absUrl():void 0,cached:{serviceToken:inChachedServiceToken,recipientID:inCachedRID}};return xmpServer.login({},options,function(value,responseHeaders){self.access||(self.access={}),self.access.serviceToken=value.serviceToken,self.debug("XmpResource.login: login succeeded with input data = ",options,". returned service token =",value.serviceToken),inRunWhenSuccess&&inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.login: login failed with input data = ",options),self.error("XmpResource.login: httpResponse = ",httpResponse)})},XmpResource.prototype.getRecipientADORs=function(inRecipientID,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var xmpServer,parameters={rid:inRecipientID,param:inOptions&&inOptions.login?"context":"",accessToken:resourceToken(this,inOptions),adors:inOptions?inOptions.adors:void 0,async:inOptions?inOptions.async:void 0,resolved:inOptions?inOptions.resolved:void 0,idIsIndex:inOptions?inOptions.idIsIndex:void 0,noCache:!!this.dontCacheGets||void 0};xmpServer=inOptions&&inOptions.idIsIndex?this.$resource(accessURL(this,inOptions)+"/resource/:accessToken/recipients/GetByIndex?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig):this.$resource(accessURL(this,inOptions)+"/v1/projects/:accessToken/adorValues/:param",null,null,this.resourceConfig);var self=this;return addOptionalLogin(this,inOptions?inOptions.login:null,parameters),xmpServer.get(parameters,function(value,responseHeaders){inOptions&&inOptions.login?(self.access||(self.access={}),self.access.serviceToken=value.login.serviceToken,self.debug("XmpResource.getRecipientADORs:+login succeeded with input data = ",parameters,"and service token =",value.login.serviceToken)):self.debug("XmpResource.getRecipientADORs: succeeded with input data = ",parameters),inRunWhenSuccess&&inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getRecipientADORs: failed with input data = ",parameters),self.error("XmpResource.getRecipientADORs: httpResponse = ",httpResponse)})},XmpResource.prototype.getRecipientsCount=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/resource/:resource/recipients?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({count:!0,resource:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getRecipientsCount: succeeded with count = ",value),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getRecipientsCount failed"),self.error("XmpResource.getRecipientsCount: httpResponse = ",httpResponse)})},XmpResource.prototype.getRecipientsIDFromIndex=function(inIndex,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/resource/:accessToken/recipients/GetByIndex?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({index:inIndex,accessToken:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getRecipientsIDFromIndex: succeeded for index =",inIndex,"value is =",value),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getRecipientsIDFromIndex failed"),self.error("XmpResource.getRecipientsIDFromIndex: httpResponse = ",httpResponse)})},XmpResource.prototype.getRecipientQueryStatus=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/v1/projects/:accessToken/asyncquery/:requestID",null,null,this.resourceConfig).get({requestID:inOptions.jobID,accessToken:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getRecipientQueryStatus: succeeded with job id = ",inOptions.jobID),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getRecipientQueryStatus: failed with job id = ",inOptions.jobID),self.error("XmpResource.getRecipientQueryStatus: httpResponse = ",httpResponse)})},XmpResource.prototype.getSchema=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/resource/:resource/schema?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({resource:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getSchema: succeeded with options = ",inOptions),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getSchema: failed with options = ",inOptions),self.error("XmpResource.getSchema: httpResponse = ",httpResponse)})},XmpResource.prototype.getAssetFetchingURL=function(inAssetName,inOptions){return accessURL(this,inOptions)+"/v1/projects/"+encodeURIComponent(resourceToken(this,inOptions))+"/assets?resolved="+encodeURIComponent(inAssetName)},XmpResource.prototype.fetchAsset=function(inAssetName,inOptions,inRunWhenFetched,inRunWhenFailed){return fetchURL(this,this.getAssetFetchingURL(inAssetName,inOptions),inRunWhenFetched,inRunWhenFailed)},XmpResource.prototype.get=function(url,inRunWhenFetched,inRunWhenFailed){var req=this.$http.get(url);return inRunWhenFetched&&req.success(inRunWhenFetched),inRunWhenFailed&&req.error(inRunWhenFailed),req},XmpResource.prototype.saveRecipientADORs=function(inRecipientID,inAdors,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/v1/projects/:accessToken/adorValues",null,{save:{method:"PUT"}},this.resourceConfig).save({rid:inRecipientID,accessToken:resourceToken(this,inOptions),adors:inOptions?inOptions.retrieveADORs:void 0,resolved:inOptions?inOptions.resolvedADORs:void 0},inAdors,function(value,responseHeaders){self.debug("XmpResource.saveRecipientADORs: succeeded with recipient id = ",inRecipientID,"and adors =",inAdors),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.saveRecipientADORs: failed with recipient id = ",inRecipientID,"and adors =",inAdors),self.error("XmpResource.saveRecipientADORs: httpResponse = ",httpResponse)})},XmpResource.prototype.signin=function(inRecipientID,username,password,successUrl,failureJs,failureAttrElement,$location,scope,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this,xmpServer=this.$resource(accessURL(this,inOptions)+"/v1/projects/auth/signIn",null,{login:{method:"POST"}},this.resourceConfig);return xmpServer.login({RecipientID:inRecipientID,AccessToken:resourceToken(this,inOptions),Password:password,UserName:username,SiteURL:this.$location.absUrl()},function(value,responseHeaders){console.log(value),setCookie("xmpSecurityToken",value.securityToken,.3),self.debug("XmpResource.signin: succeeded with recipient id = ",inRecipientID),inRunWhenSuccess(value,responseHeaders),successUrl&&changeLocation(scope,$location,successUrl,!0)},function(httpResponse){httpResponse.response&&-1!==httpResponse.response.config.url.indexOf("/projects/auth/signIn")||(inRunWhenFailed(httpResponse),self.error("XmpResource.signin: failed with recipient id = ",inRecipientID),self.error("XmpResource.signin: httpResponse = ",httpResponse.message||httpResponse)),failureAttrElement&&failureAttrElement.addClass(failureAttrElement.attr("xmp-signin-status-class")),failureJs&&eval(failureJs)})},XmpResource.prototype.signOut=function(inRecipientID,successUrl,$location,scope,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/v1/projects/auth/signOut",null,{logout:{method:"POST",headers:{accessToken:resourceToken(this,inOptions)}}},this.resourceConfig).logout({RecipientID:inRecipientID},function(value,responseHeaders){deleteCookie("xmpSecurityToken"),self.debug("XmpResource.signOut: succeeded with recipient id = ",inRecipientID),inRunWhenSuccess(value,responseHeaders),successUrl?changeLocation(scope,$location,successUrl,!0):xmpcustom&&xmpcustom.loginUrl&&changeLocation(scope,$location,xmpcustom.loginUrl,!0)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.signOut: failed with recipient id = ",inRecipientID),self.error("XmpResource.signOut: httpResponse = ",httpResponse)})},XmpResource.prototype.addRecipient=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/v1/projects/:accessToken/adorValues",null,{add:{method:"POST"}},this.resourceConfig).add({accessToken:resourceToken(this,inOptions)},{newRecipientValues:inOptions.adors,newRecipientRetrieveADORs:inOptions.retrieveADORs,newRecipientResolvedADORs:inOptions.resolvedADORs},function(value,responseHeaders){self.debug("XmpResource.addRecipient: succeeded with values = ",inOptions.adors,"and retrieved adors =",inOptions.retrieveADORs),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.addRecipient: failed with values = ",inOptions.adors,"and retrieved adors =",inOptions.retrieveADORs),self.error("XmpResource.addRecipient: httpResponse = ",httpResponse)})},XmpResource.prototype.addDefaultTrackingParameters=function(inParametersObject){return inParametersObject.ScreenResolution=screen.width+"x"+screen.height,inParametersObject.Browser=platform.name+" "+platform.version,inParametersObject.Platform=platform.os.family+" "+platform.os.version,inParametersObject.HumanLanguage=navigator.systemLanguage||navigator.language||"Unknown",inParametersObject.PageURI=this.$location.absUrl().substr(0,this.$location.absUrl().length-this.$location.url().length+this.$location.path().length),inParametersObject.ReferringPageURI=document.referrer,inParametersObject.PageParams=this.$location.url().substr(this.$location.path().length+1),inParametersObject.JavaEnabled="true",inParametersObject.ISLandingPage="TBD",inParametersObject.ClientIP="TBD",inParametersObject.UserSession="TBD",inParametersObject},XmpResource.prototype.trackEvent=function(inEventType,inOptions,inRunWhenSuccess,inRunWhenFailed){var parameters={type:inEventType,recipientID:inOptions.recipientID,date:inOptions.date?inOptions.date.toUTCString():(new Date).toUTCString()};if(inOptions&&inOptions.properties)for(var v in inOptions.properties)inOptions.properties.hasOwnProperty(v)&&(parameters[v]=inOptions.properties[v]);inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var runWhenSuccess=function(value,responseHeaders){this.debug("XmpResource.trackEvent: succeeded with parameters = ",parameters),inRunWhenSuccess(value,responseHeaders)}.bind(this),runWhenFailed=function(httpResponse){inRunWhenFailed(),this.$log.error("XmpResource.trackEvent: failed with parameters = ",parameters),this.$log.error("XmpResource.trackEvent: httpResponse = ",httpResponse)}.bind(this);if(!inOptions||!inOptions.sync){return this.$resource(accessURL(this,inOptions)+"/v1/projects/:accessToken/events",null,{add:{method:"POST"}},this.resourceConfig).add({accessToken:resourceToken(this,inOptions)},parameters,runWhenSuccess,runWhenFailed)}var ajaxObj={type:"POST",url:accessURL(this,inOptions)+"/v1/projects/"+encodeURIComponent(resourceToken(this,inOptions))+"/events",data:JSON.stringify(parameters),contentType:"application/json; charset=utf-8",success:runWhenSuccess,async:!1,timeout:this.timeout};getCookie("xmpSecurityToken")&&(ajaxObj.headers={xmpSecurityToken:getCookie("xmpSecurityToken")}),$.ajax(ajaxObj).fail(runWhenFailed)},XmpResource.prototype.sendEmailorTrigger=function(inTouchpointID,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var runWhenSuccess=function(value,responseHeaders){
this.debug("XmpResource.sendEmailorTrigger: succeeded with email touchpoint id =",inTouchpointID,"recipient id =",inOptions.recipientID,"customizations =",inOptions.customizations),inRunWhenSuccess(value,responseHeaders)}.bind(this),runWhenFailed=function(httpResponse){inRunWhenFailed(httpResponse),this.$log.error("XmpResource.sendEmailorTrigger: failed with email touchpoint id =",inTouchpointID,"recipient id =",inOptions.recipientID,"customizations =",inOptions.customizations),this.$log.error("XmpResource.sendEmailorTrigger: httpResponse = ",httpResponse)}.bind(this);if(!inOptions||!inOptions.sync){return this.$resource(accessURL(this,inOptions)+"/v1/projects/:accessToken/touchpoints/trigger",null,{send:{method:"POST"}},this.resourceConfig).send({accessToken:resourceToken(this,inOptions)},{touchPointID:inTouchpointID,recipientID:inOptions.recipientID,customizations:inOptions.customizations},runWhenSuccess,runWhenFailed)}var ajaxObj={type:"POST",url:accessURL(this,inOptions)+"/v1/projects/"+encodeURIComponent(resourceToken(this,inOptions))+"/touchpoints/trigger",data:JSON.stringify({touchPointID:inTouchpointID,recipientID:inOptions.recipientID,customizations:inOptions.customizations}),contentType:"application/json; charset=utf-8",success:runWhenSuccess,async:!1};getCookie("xmpSecurityToken")&&(ajaxObj.headers={xmpSecurityToken:getCookie("xmpSecurityToken")}),$.ajax(ajaxObj).fail(runWhenFailed)},XmpResource.prototype.getDocuments=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp;var self=this;return inRunWhenFailed=inRunWhenFailed||noOp,this.$resource(accessURL(this,inOptions)+"/resource/:resource/documents?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({resource:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getDocuments: succeeded with resource = ",resourceToken(self,inOptions)),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getDocuments: failed with resource = ",resourceToken(self,inOptions)),self.error("XmpResource.getDocuments: httpResponse = ",httpResponse)})},XmpResource.prototype.getEmailDocuments=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp;var self=this;return inRunWhenFailed=inRunWhenFailed||noOp,this.$resource(accessURL(this,inOptions)+"/resource/:resource/emaildocuments?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({resource:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getEmailDocuments: succeeded with resource = ",resourceToken(self,inOptions)),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getEmailDocuments: failed with resource = ",resourceToken(self,inOptions)),self.error("XmpResource.getEmailDocuments: httpResponse = ",httpResponse)})},XmpResource.prototype.getEmailTouchpoints=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/resource/:resource/emailtouchpoints?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({resource:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getEmailTouchpoints: succeeded with resource = ",resourceToken(self,inOptions)),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getEmailTouchpoints: failed with resource = ",resourceToken(self,inOptions)),self.error("XmpResource.getEmailTouchpoints: httpResponse = ",httpResponse)})},XmpResource.prototype.getEmailFooters=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/resource/:resource/emailfooters?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({resource:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getEmailFooters: succeeded with resource = ",resourceToken(self,inOptions)),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getEmailFooters: failed with resource = ",resourceToken(self,inOptions)),self.error("XmpResource.getEmailFooters: httpResponse = ",httpResponse)})},XmpResource.prototype.startGenerationJob=function(inDocumentID,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/resource/:resource/generationjobs?Authorization="+GetCircleTokenEncrypted(),null,{send:{method:"POST"}},this.resourceConfig).send({resource:resourceToken(this,inOptions)},{documentID:inDocumentID,recipientID:inOptions.recipientID},function(value,responseHeaders){self.debug("XmpResource.startGenerationJob: succeeded with document id =",inDocumentID,"and recipient ID =",inOptions.recipientID),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.startGenerationJob: failed with document id =",inDocumentID,"and recipient ID =",inOptions.recipientID),self.error("XmpResource.startGenerationJob: httpResponse = ",httpResponse)})},XmpResource.prototype.getGenerationJobStatus=function(inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this;return this.$resource(accessURL(this,inOptions)+"/resource/:resource/generationjobs/"+inOptions.jobID+"?Authorization="+GetCircleTokenEncrypted(),null,null,this.resourceConfig).get({resource:resourceToken(this,inOptions)},function(value,responseHeaders){self.debug("XmpResource.getGenerationJobStatus: succeeded with job id = ",inOptions.jobID),inRunWhenSuccess(value,responseHeaders)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.getGenerationJobStatus: failed with job id = ",inOptions.jobID),self.error("XmpResource.getGenerationJobStatus: httpResponse = ",httpResponse)})},XmpResource.prototype.getGeneratedFileFetchingURL=function(inOptions){var fileID="string"==typeof inOptions?inOptions:inOptions.fileID;return accessURL(this,inOptions)+"/resource/"+encodeURIComponent(resourceToken(this,inOptions))+"/generatedfiles/"+encodeURIComponent(fileID)+"?Authorization="+GetCircleTokenEncrypted()},XmpResource.prototype.fetchGeneratedFile=function(inOptions,inRunWhenFetched,inRunWhenFailed){return fetchURL(this,this.getGeneratedFileFetchingURL(inOptions),inRunWhenFetched,inRunWhenFailed)},XmpResource.prototype.changeUnsubscribeStatus=function(scope,$parse,$location,iAttrs,inRecipientID,inUnsubscribe,inOptions,inRunWhenSuccess,inRunWhenFailed){inRunWhenSuccess=inRunWhenSuccess||noOp,inRunWhenFailed=inRunWhenFailed||noOp;var self=this,xmpServer=this.$resource(accessURL(this,inOptions)+"/v1/projects/:accessToken/touchpoints/trigger/unsubscribe",null,{save:{method:"PUT"}},this.resourceConfig);return xmpServer.save({accessToken:resourceToken(this,inOptions)},{status:inUnsubscribe,recipientID:inRecipientID,siteURL:this.$location.absUrl()},function(value,responseHeaders){self.debug("XmpResource.changeUnsubscribeStatus: succeeded with recipient id =",inRecipientID,"and unsubscribe status =",inUnsubscribe),inRunWhenSuccess(value,responseHeaders),iAttrs.xmpSuccessNg&&$parse(iAttrs.xmpSuccessNg)(scope),iAttrs.xmpSuccessJs&&eval(iAttrs.xmpSuccessJs),iAttrs.xmpSuccessUrl&&changeLocation(scope,$location,iAttrs.xmpSuccessUrl,!0)},function(httpResponse){inRunWhenFailed(httpResponse),self.error("XmpResource.changeUnsubscribeStatus: failed with recipient id =",inRecipientID,"and unsubscribe status =",inUnsubscribe),self.error("XmpResource.changeUnsubscribeStatus: httpResponse = ",httpResponse),iAttrs.xmpFailureNg&&$parse(iAttrs.xmpFailureNg)(scope),iAttrs.xmpFailureJs&&eval(iAttrs.xmpFailureJs),iAttrs.xmpFailureUrl&&changeLocation(scope,$location,iAttrs.xmpFailureUrl,!0)})},XmpResource.prototype.populateRecipientADORsInExpression=function(inExpression,inRecipientDictionary,inReferredRecipientDictionary,excludeRefer,excludeRecipient,AdorDefaultVal){var results;excludeRecipient||(results=inExpression.match(/xmp\.r\.[\w]+/g),results&&results.forEach(function(inElement){inRecipientDictionary[inElement.substring(6)]=AdorDefaultVal||!0}),(results=inExpression.match(/xmp\.r\[(\"|\')[^\]]+/g))&&results.forEach(function(inElement){inRecipientDictionary[inElement.substring(7,inElement.length-1)]=AdorDefaultVal||!0})),excludeRefer||(results=inExpression.match(/xmp\.referredRecipient\.[\w]+/g),results&&results.forEach(function(inElement){inReferredRecipientDictionary[inElement.substring(22)]=AdorDefaultVal||!0}),(results=inExpression.match(/xmp\.referredRecipient\[(\"|\')[^\]]+/g))&&results.forEach(function(inElement){inReferredRecipientDictionary[inElement.substring(23,inElement.length-1)]=AdorDefaultVal||!0}))},XmpResource.prototype.declareRecipientADORsInExpression=function(inExpression){this.createDefaultRetrieveDictionaries(),this.populateRecipientADORsInExpression(inExpression,this.defaultAdorsForGet,this.defaultAdorsForReferredGet)},XmpResource.prototype.declareRecipientResolvedADORsInExpression=function(inExpression){this.createDefaultRetrieveDictionaries(),this.populateRecipientADORsInExpression(inExpression,this.defaultAdorsForResolve,this.defaultAdorsForReferredResolve)},XmpResource.prototype.declareRecipientADORsInAttributes=function(inAttributes){this.createDefaultRetrieveDictionaries(),this.populateRecipientADORsInAttributes(inAttributes,this.defaultAdorsForGet,this.defaultAdorsForReferredGet)},XmpResource.prototype.populateRecipientADORsInAttributes=function(inAttributes,inRecipientDictionary,inReferredRecipientDictionary,excludeRefer,excludeRecipient,dontCheckForExclusion){if(!attributesExcludeCollection(inAttributes)){dontCheckForExclusion||(excludeRefer|=shouldExcludeReferredSearch(inAttributes));var self=this;angular.forEach(inAttributes,function(value,key){attributeCanBeCollected(key)&&self.populateRecipientADORsInExpression(value,inRecipientDictionary,inReferredRecipientDictionary,excludeRefer,excludeRecipient)})}},XmpResource.prototype.declareRecipientADORsInJQueryElement=function(inJElement){this.createDefaultRetrieveDictionaries(),this.populateRecipientADORsInJQueryElement(inJElement,this.defaultAdorsForGet,this.defaultAdorsForReferredGet)},XmpResource.prototype.createDefaultRetrieveDictionaries=function(){this.defaultAdorsForGet||(this.defaultAdorsForGet={}),this.defaultAdorsForReferredGet||(this.defaultAdorsForReferredGet={}),this.defaultAdorsForResolve||(this.defaultAdorsForResolve={}),this.defaultAdorsForReferredResolve||(this.defaultAdorsForReferredResolve={})},XmpResource.prototype.populateRecipientADORsInJQueryElement=function(inJElement,inRecipientDictionary,inReferredRecipientDictionary,excludeRefer,excludeRecipient,dontCheckForExclusion){inJElement[0].attributes&&this.populateRecipientADORsInAttributes(htmlAttrsToPlainKeyValue(inJElement[0].attributes),inRecipientDictionary,inReferredRecipientDictionary,excludeRefer,excludeRecipient,dontCheckForExclusion),inJElement[0].attributes&&!dontCheckForExclusion&&(excludeRefer|=shouldExcludeReferredSearch(htmlAttrsToPlainKeyValue(inJElement[0].attributes))),3!=inJElement[0].nodeType&&8!=inJElement[0].nodeType||this.populateRecipientADORsInExpression(inJElement[0].nodeValue,inRecipientDictionary,inReferredRecipientDictionary,excludeRefer,excludeRecipient);var self=this;inJElement.is("iframe")||inJElement.contents().each(function(){self.populateRecipientADORsInJQueryElement($(this),inRecipientDictionary,inReferredRecipientDictionary,excludeRefer,excludeRecipient,dontCheckForExclusion)})},XmpResource.prototype.debug=function(){this.debugEnabled&&(console.debug.apply(console,arguments),canDebugExternal()&&uCreateXMGlobal.logDebugFromExternalLibrary.apply(uCreateXMGlobal,arguments))},XmpResource.prototype.error=function(){this.$log.error.apply(this.$log,arguments),canDebugExternal()&&uCreateXMGlobal.logErrorFromExternalLibrary.apply(uCreateXMGlobal,arguments)};var xmpServices=angular.module("xmp.services",["ngResource"]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("noCacheInterceptor"),$httpProvider.interceptors.push("xmHttpInterceptor")}]).factory("noCacheInterceptor",function(){return{request:function(config){if("GET"==config.method){var separator=-1===config.url.indexOf("?")?"?":"&";config.url=config.url+separator+"ieNoCache="+(new Date).getTime()}return config}}}).factory("xmHttpInterceptor",["$q","$cookies",function($q,$cookies){return{request:function(config){return getCookie("xmpSecurityToken")&&(config.headers.xmpSecurityToken=getCookie("xmpSecurityToken")),canDebugExternal()&&uCreateXMGlobal.logDebugFromExternalLibrary("xmHttpInterceptor xmp.services - request sent :",config),config},response:function(response){return canDebugExternal()&&uCreateXMGlobal.logDebugFromExternalLibrary("xmHttpInterceptor xmp.services - response returned : ",response),response},responseError:function(response){if(/\/events$/.test(response.config.url)||(window.XMPLLastHttpError=response),400===response.status&&response.data&&9==response.data.ErrorCode){if(null!=response.data.RecipientID&&""!=response.data.RecipientID&&setCookie("xmpRecipientID",response.data.RecipientID,9999),null!=response.data.ServiceToken&&""!=response.data.ServiceToken&&setCookie("xmpServiceToken",response.data.ServiceToken,9999),window.xmpSigninOnPage)return $q.reject({response:response,message:"xmHttpInterceptor xmp.services -  login failed "});if("undefined"!=typeof xmpcustom&&xmpcustom.loginUrl){var params=[{key:"rid",value:response.data.RecipientID},{key:"IID",value:function(){var param=location.search.replace(/^\?/,"").split("&").filter(function(q){return/^iid=/i.test(q)})[0];return param?param.replace(/^iid=/i,""):null}()}].filter(function(p){return!!p.value}).map(function(p){return[p.key,"=",p.value].join("")}).join("&");window.location.href=xmpcustom.loginUrl+(params?"?":"")+params}}return canDebugExternal()&&uCreateXMGlobal.logErrorFromExternalLibrary("xmHttpInterceptor xmp.services - error in response : ",response),$q.reject(response)}}}]);xmpServices.provider("xmpResource",function(){var options=null;this.configure=function(inOptions){options=inOptions},this.$get=["$resource","$http","$location","$log",function($resource,$http,$location,$log){return new XmpResource($resource,$http,$location,$log,options)}]}),function(){var deleteAllXmpCookiesRef=deleteAllXmpCookies,xmpClearCookieOnLoad=document.body.getAttribute("xmp-clear-all-cookies-onload");void 0!==xmpClearCookieOnLoad&&null!=xmpClearCookieOnLoad&&deleteAllXmpCookiesRef()}();var xmpApp=angular.module("xmp.app",["xmp.directives","xmp.controllers","xmp.services"]).config(["xmpResourceProvider",function(inProvider){inProvider.configure({access:xmpcfg.access,timeout:xmpcfg.timeout,test:xmpcfg.isTest})}]).value("appConfig",function(){return{asyncAttempts:xmpcfg.asyncAttempts,asyncWaitTime:xmpcfg.asyncWaitTime}}).filter("xmpTrustUrl",function($sce){return function(url){return $sce.trustAsResourceUrl(url)}}),xmpResourceDriverXmpl=function(inInitialization,inDoLogin,inDecipherRecipientID){var self=this;inInitialization&&inInitialization.configuration?(angular.module("xmp.app",inDoLogin?["xmp.services","ngCookies"]:["xmp.services"]).config(["xmpResourceProvider",function(inProvider){inProvider.configure(inInitialization.configuration)}]),angular.element(document).ready(function(){self.injector=angular.bootstrap(document,["xmp.app"]),init(self,inDoLogin,inDecipherRecipientID)})):(inInitialization&&inInitialization.element?self.injector=angular.element(inInitialization.element).injector():inInitialization&&inInitialization.injector?self.injector=inInitialization.injector:self.injector=angular.element(document).injector(),init(self,inDoLogin,inDecipherRecipientID))};xmpResourceDriverXmpl.prototype.ready=function(inCB){if(this.isReady)return inCB.call(this);$(this).one("xmpResourceDriverXMPL::ready",inCB)};var xmpControllerDriverXmpl=function(inJController){this.controller=angular.element(inJController),Object.defineProperty(this,"xmp",{get:function(){return this.controller.scope().xmp},enumerable:!0,configurable:!0}),Object.defineProperty(this,"scope",{get:function(){return this.controller.scope()},enumerable:!0,configurable:!0})};xmpControllerDriverXmpl.prototype.ready=function(inCB){this.scope.xmpReady(inCB)};

/***********************************************************************************/
//Because we place all block in $(document).ready function we needed to expose these global variables outside xmpControllerDriver, xmpResourceDriver
xmpControllerDriver = xmpControllerDriverXmpl;
xmpResourceDriver = xmpResourceDriverXmpl;

//mapOnReady is a variable that will be used by xmp-map directive, will be be fired once angular xmp.app modules are ready
if (typeof mapOnReady != 'undefined')
	mapOnReady();

//angularComponenetsOnReady is a variable that will be used by a user who develop customized script and defined new directive, controller or new angular applicaton on top of xmp.app application
//will be be fired once angular xmp.app modules are ready
if (typeof angularComponentsOnReady != 'undefined')
	angularComponentsOnReady();

//xmplOnReady is a variable that will be defined by a user who develop customized script, the function xmplOnReady will be fired once xmp.app directived and controllers are ready in the browser
angular.element(document).ready(function () {
if (typeof xmplOnReady != 'undefined') 
	xmplOnReady();
});

});//end $(document).ready(function() 

}; //end loadXmplGeneralScript


waitForScriptLoad(1);

